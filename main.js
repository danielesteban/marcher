!function(){"use strict";function e(){}function t(e){return e()}function n(){return Object.create(null)}function o(e){e.forEach(t)}function r(e){return"function"==typeof e}function i(e,t){return e!=e?t==t:e!==t||e&&"object"==typeof e||"function"==typeof e}function s(t,...n){if(null==t)return e;const o=t.subscribe(...n);return o.unsubscribe?()=>o.unsubscribe():o}function a(e){let t;return s(e,(e=>t=e))(),t}function c(e,t,n){e.$$.on_destroy.push(s(t,n))}function l(e,t,n,o){if(e){const r=u(e,t,n,o);return e[0](r)}}function u(e,t,n,o){return e[1]&&o?function(e,t){for(const n in t)e[n]=t[n];return e}(n.ctx.slice(),e[1](o(t))):n.ctx}function f(e,t,n,o){if(e[2]&&o){const r=e[2](o(n));if(void 0===t.dirty)return r;if("object"==typeof r){const e=[],n=Math.max(t.dirty.length,r.length);for(let o=0;o<n;o+=1)e[o]=t.dirty[o]|r[o];return e}return t.dirty|r}return t.dirty}function d(e,t,n,o,r,i){if(r){const s=u(t,n,o,i);e.p(s,r)}}function p(e){if(e.ctx.length>32){const t=[],n=e.ctx.length/32;for(let e=0;e<n;e++)t[e]=-1;return t}return-1}function h(e,t,n){return e.set(n),t}function m(e,t){e.appendChild(t)}function v(e,t,n){e.insertBefore(t,n||null)}function g(e){e.parentNode.removeChild(e)}function x(e,t){for(let n=0;n<e.length;n+=1)e[n]&&e[n].d(t)}function b(e){return document.createElement(e)}function y(e){return document.createTextNode(e)}function $(){return y(" ")}function w(){return y("")}function k(e,t,n,o){return e.addEventListener(t,n,o),()=>e.removeEventListener(t,n,o)}function S(e,t,n){null==n?e.removeAttribute(t):e.getAttribute(t)!==n&&e.setAttribute(t,n)}function M(e,t){t=""+t,e.wholeText!==t&&(e.data=t)}function F(e,t,n,o){null===n?e.style.removeProperty(t):e.style.setProperty(t,n,o?"important":"")}function L(e,t){for(let n=0;n<e.options.length;n+=1){const o=e.options[n];if(o.__value===t)return void(o.selected=!0)}e.selectedIndex=-1}function D(e,t,n){e.classList[n?"add":"remove"](t)}let z;function E(e){z=e}function P(){if(!z)throw new Error("Function called outside component initialization");return z}function _(e){P().$$.on_mount.push(e)}const q=[],C=[],T=[],j=[],R=Promise.resolve();let B=!1;function U(){B||(B=!0,R.then(G))}function I(){return U(),R}function N(e){T.push(e)}const A=new Set;let O=0;function G(){const e=z;do{for(;O<q.length;){const e=q[O];O++,E(e),V(e.$$)}for(E(null),q.length=0,O=0;C.length;)C.pop()();for(let e=0;e<T.length;e+=1){const t=T[e];A.has(t)||(A.add(t),t())}T.length=0}while(q.length);for(;j.length;)j.pop()();B=!1,A.clear(),E(e)}function V(e){if(null!==e.fragment){e.update(),o(e.before_update);const t=e.dirty;e.dirty=[-1],e.fragment&&e.fragment.p(e.ctx,t),e.after_update.forEach(N)}}const W=new Set;let Y;function H(){Y={r:0,c:[],p:Y}}function X(){Y.r||o(Y.c),Y=Y.p}function K(e,t){e&&e.i&&(W.delete(e),e.i(t))}function J(e,t,n,o){if(e&&e.o){if(W.has(e))return;W.add(e),Y.c.push((()=>{W.delete(e),o&&(n&&e.d(1),o())})),e.o(t)}else o&&o()}const Z="undefined"!=typeof window?window:"undefined"!=typeof globalThis?globalThis:global;function Q(e){e&&e.c()}function ee(e,n,i,s){const{fragment:a,on_mount:c,on_destroy:l,after_update:u}=e.$$;a&&a.m(n,i),s||N((()=>{const n=c.map(t).filter(r);l?l.push(...n):o(n),e.$$.on_mount=[]})),u.forEach(N)}function te(e,t){const n=e.$$;null!==n.fragment&&(o(n.on_destroy),n.fragment&&n.fragment.d(t),n.on_destroy=n.fragment=null,n.ctx=[])}function ne(t,r,i,s,a,c,l,u=[-1]){const f=z;E(t);const d=t.$$={fragment:null,ctx:null,props:c,update:e,not_equal:a,bound:n(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(r.context||(f?f.$$.context:[])),callbacks:n(),dirty:u,skip_bound:!1,root:r.target||f.$$.root};l&&l(d.root);let p=!1;if(d.ctx=i?i(t,r.props||{},((e,n,...o)=>{const r=o.length?o[0]:n;return d.ctx&&a(d.ctx[e],d.ctx[e]=r)&&(!d.skip_bound&&d.bound[e]&&d.bound[e](r),p&&function(e,t){-1===e.$$.dirty[0]&&(q.push(e),U(),e.$$.dirty.fill(0)),e.$$.dirty[t/31|0]|=1<<t%31}(t,e)),n})):[],d.update(),p=!0,o(d.before_update),d.fragment=!!s&&s(d.ctx),r.target){if(r.hydrate){const e=function(e){return Array.from(e.childNodes)}(r.target);d.fragment&&d.fragment.l(e),e.forEach(g)}else d.fragment&&d.fragment.c();r.intro&&K(t.$$.fragment),ee(t,r.target,r.anchor,r.customElement),G()}E(f)}class oe{$destroy(){te(this,1),this.$destroy=e}$on(e,t){const n=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return n.push(t),()=>{const e=n.indexOf(t);-1!==e&&n.splice(e,1)}}$set(e){var t;this.$$set&&(t=e,0!==Object.keys(t).length)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}const re=[];function ie(t,n=e){let o;const r=new Set;function s(e){if(i(t,e)&&(t=e,o)){const e=!re.length;for(const e of r)e[1](),re.push(e,t);if(e){for(let e=0;e<re.length;e+=2)re[e][0](re[e+1]);re.length=0}}}return{set:s,update:function(e){s(e(t))},subscribe:function(i,a=e){const c=[i,a];return r.add(c),1===r.size&&(o=n(s)||e),i(t),()=>{r.delete(c),0===r.size&&(o(),o=null)}}}}let se=!1;const ae=(e,t)=>{e=`marcher:${e}`;const n=localStorage.getItem(e),{subscribe:o,set:r}=ie(n?JSON.parse(n):t);return{subscribe:o,set:t=>{r(t),localStorage.setItem(e,JSON.stringify(t)),!se&&location.hash.slice(2)&&(location.hash="/")}}},ce={fetch:ie(!1),publish:ie(!1)},le=ie("scene"),ue=["const background : vec3<f32> = vec3<f32>(0, 0, 0);\nconst fogDensity : f32 = 0.005;\n\nfn getEffect(pixel : vec2<i32>) -> vec3<f32> {\n  let data : vec4<f32> = textureLoad(dataTexture, pixel, 0);\n  let depth : f32 = data.w;\n  if (depth >= camera.far) {\n    return background;\n  }\n  let color : vec4<f32> = textureLoad(colorTexture, pixel, 0);\n  let position : vec3<f32> = textureLoad(positionTexture, pixel, 0).xyz;\n  var out : vec3<f32> = color.xyz * getLight(data.xyz, position);\n  out = mix(out, background, 1 - exp(-fogDensity * fogDensity * depth * depth) * color.w);\n  return out;\n}\n\nfn getLight(normal : vec3<f32>, position : vec3<f32>) -> vec3<f32> {\n  return (\n    0.1\n    + getDirectLight(Light(position + vec3<f32>(0, 1, 0), vec3<f32>(1), vec3<f32>(0.3)), normal, position, 32) * 0.5\n    + getDirectLight(Light(position + vec3<f32>(1, 1, 1), vec3<f32>(1), vec3<f32>(0.3)), normal, position, 32) * 0.25\n    + getDirectLight(Light(position + vec3<f32>(-1, 1, -1), vec3<f32>(1), vec3<f32>(0.3)), normal, position, 32) * 0.25\n  );\n}\n","const background : vec3<f32> = vec3<f32>(0, 0, 0);\nconst fogDensity : f32 = 0.005;\n\nconst edgeColor : vec3<f32> = vec3<f32>(0, 0, 0);\nconst edgeIntensity : f32 = 0.5;\nconst depthScale : f32 = 0.5;\nconst depthBias : f32 = 1;\nconst normalBias : f32 = 10;\nconst normalScale : f32 = 0.5;\n\nfn getEffect(pixel : vec2<i32>) -> vec3<f32> {\n  let data : vec4<f32> = textureLoad(dataTexture, pixel, 0);\n  let depth : f32 = data.w;\n  if (depth >= camera.far) {\n    return background;\n  }\n  let color : vec4<f32> = textureLoad(colorTexture, pixel, 0);\n  let position : vec3<f32> = textureLoad(positionTexture, pixel, 0).xyz;\n  var out : vec3<f32> = color.xyz * getLight(data.xyz, position);\n  out = mix(out, edgeColor, getEdge(pixel, data) * edgeIntensity);\n  out = mix(out, background, 1 - exp(-fogDensity * fogDensity * depth * depth) * color.w);\n  return out;\n}\n\nfn getLight(normal : vec3<f32>, position : vec3<f32>) -> vec3<f32> {\n  return (\n    0.1\n    + getDirectLight(Light(position + vec3<f32>(0, 1, 0), vec3<f32>(1), vec3<f32>(0.3)), normal, position, 32) * 0.5\n    + getDirectLight(Light(position + vec3<f32>(1, 1, 1), vec3<f32>(1), vec3<f32>(0.3)), normal, position, 32) * 0.25\n    + getDirectLight(Light(position + vec3<f32>(-1, 1, -1), vec3<f32>(1), vec3<f32>(0.3)), normal, position, 32) * 0.25\n  );\n}\n\nfn getEdge(pixel : vec2<i32>, data : vec4<f32>) -> f32 {\n  const offset : vec3<i32> = vec3<i32>(1, 1, 0);\n  let dataLeft : vec4<f32> = textureLoad(dataTexture, pixel - offset.xz, 0);\n  let dataRight : vec4<f32> = textureLoad(dataTexture, pixel + offset.xz, 0);\n  let dataUp : vec4<f32> = textureLoad(dataTexture, pixel + offset.zy, 0);\n  let dataDown : vec4<f32> = textureLoad(dataTexture, pixel - offset.zy, 0);\n  let edge : vec4<f32> = (\n    abs(dataLeft - data)\n    + abs(dataRight - data) \n    + abs(dataUp - data) \n    + abs(dataDown - data)\n  );\n  return clamp(max(pow((edge.x + edge.y + edge.z) * normalScale, normalBias), pow(edge.w * depthScale, depthBias)), 0, 1);\n}\n","const background : vec3<f32> = vec3<f32>(0, 0, 0);\nconst fogDensity : f32 = 0.005;\n\nfn getEffect(pixel : vec2<i32>) -> vec3<f32> {\n  let data : vec4<f32> = textureLoad(dataTexture, pixel, 0);\n  let depth : f32 = data.w;\n  if (depth >= camera.far) {\n    return background;\n  }\n  let color : vec4<f32> = textureLoad(colorTexture, pixel, 0);\n  let position : vec3<f32> = textureLoad(positionTexture, pixel, 0).xyz;\n  var out : vec3<f32> = color.xyz * getLight(data.xyz, position);\n  out = mix(out, background, 1 - exp(-fogDensity * fogDensity * depth * depth) * color.w);\n  return out;\n}\n\nfn getLight(normal : vec3<f32>, position : vec3<f32>) -> vec3<f32> {\n  let light : Light = Light(\n    camera.position,\n    vec3<f32>(1, 1, 1),\n    vec3<f32>(0.3)\n  );\n  let theta = dot(camera.direction, -normalize(light.position - position));\n  return (\n    (\n      getDirectLight(light, normal, position, 128)\n      * getAttenuation(distance(light.position, position), 1, 0.007, 0.0002)\n      * clamp((theta - PI * 0.2) / (PI * 0.5), 0, 1)\n    )\n  );\n}\n","const background : vec3<f32> = vec3<f32>(0, 0, 0);\n\nfn getEffect(pixel : vec2<i32>) -> vec3<f32> {\n  let data : vec4<f32> = textureLoad(dataTexture, pixel, 0);\n  let depth : f32 = data.w;\n  if (depth >= camera.far) {\n    return background;\n  }\n  let color : vec4<f32> = textureLoad(colorTexture, pixel, 0);\n  let position : vec3<f32> = textureLoad(positionTexture, pixel, 0).xyz;\n  var out : vec3<f32> = color.xyz * getLight(data.xyz, position);\n  out = mix(out, background, 1 - color.w);\n  return out;\n}\n\nfn getLight(normal : vec3<f32>, position : vec3<f32>) -> vec3<f32> {\n  const target : vec3<f32> = vec3<f32>(0, 0, -8);\n  let lights : array<Light, 2> = array<Light, 2>(\n    Light(\n      target + spherical(PI * 0.25, time, 8),\n      vec3<f32>(0.8, 0.4, 0),\n      vec3<f32>(0.3)\n    ),\n    Light(\n      target + spherical(PI * 0.25, time - PI, 8),\n      vec3<f32>(0, 0.2, 0.8),\n      vec3<f32>(0.3)\n    ),\n  );\n  var light : vec3<f32> = vec3<f32>(0.01);\n  for (var i : u32 = 0; i < 2; i++) {\n    light += (\n      getDirectLight(lights[i], normal, position, 32)\n      * getAttenuation(distance(lights[i].position, position), 1, 0.09, 0.032)\n    );\n  }\n  return light;\n}\n"],fe={editor:null,errors:ie([]),source:ae("effect",ue[0])},de=["fn getScene(pos : vec3<f32>) -> SDF {\n  let q : vec3<f32> = pos - vec3<f32>(0, 0, -8);\n  let d : f32 = sin(q.x * 10) * sin(q.y * 10) * sin(q.z * 10) * 0.1;\n  return SDF(\n    vec3<f32>(1, 1, 1) - vec3<f32>(d * 10, d * 5, d * 5),\n    sdSphere(q, 4) + d\n  );\n}\n","fn getScene(pos : vec3<f32>) -> SDF {\n  let q : vec3<f32> = pos - vec3<f32>(0, 0, -8);\n  let d : f32 = sin(q.x * 10) * sin(q.y * 10) * sin(q.z * 10) * 0.1;\n\n  let a : SDF = SDF(\n    vec3<f32>(1, 1, 1) - vec3<f32>(d * 10, d * 5, d * 5),\n    sdSphere(q, 4) + d\n  );\n\n  let b : SDF = SDF(\n    clamp(vec3<f32>(0.5, 0.5, 0.5) + vec3<f32>(d * 10, d * 5, d * 5), vec3<f32>(0), vec3<f32>(1)),\n    sdSphere(q - vec3<f32>(0, 0, 4), 2) + d\n  );\n\n  return opSmoothSubstraction(a, b, 0.15);\n}\n","fn getScene(pos : vec3<f32>) -> SDF {\n  var scene : SDF = SDF(\n    vec3<f32>(.8, .1, .05),\n    sdBox(rotateY(PI * 0.25) * rotateX(PI * 0.25) * (pos - vec3<f32>(-7, 0, -10)), vec3<f32>(1, 1, 1))\n  );\n  scene = opUnion(scene, SDF(\n    vec3<f32>(.8, .2, .05),\n    sdCapsule(pos - vec3<f32>(-3.5, 0, -10), vec2<f32>(0.5, 2))\n  ));\n  scene = opUnion(scene, SDF(\n    vec3<f32>(.2, .2, .8),\n    sdSphere(pos - vec3<f32>(0, 0, -10), 1)\n  ));\n  scene = opUnion(scene, SDF(\n    vec3<f32>(.8, .2, .05),\n    sdEllipsoid(pos - vec3<f32>(3.5, 0, -10), vec3<f32>(1, 2, 1))\n  ));\n  scene = opUnion(scene, SDF(\n    vec3<f32>(.8, .1, .05),\n    sdTorus(rotateX(PI * 0.5) * (pos - vec3<f32>(7, 0, -10)), vec2<f32>(1, 0.25))\n  ));\n  scene = opSmoothUnion(scene, SDF(\n    vec3<f32>(0.8, 0.8, 0.1),\n    sdPlane(pos, vec3<f32>(0, 1, 0), 1.5)\n  ), 1);\n  return scene;\n}\n","fn getScene(pos : vec3<f32>) -> SDF {\n  const r : vec3<f32> = vec3<f32>(8, 8, 8);\n  let q = abs(pos % r) - r * 0.5;\n\n  let id : vec3<f32> = floor(pos / r);\n  let n = SimplexNoise(id);\n  let s = 1 + sin(id.x * id.y * id.z);\n  let di = 2 + (abs(id.x + id.y + id.z) % 8);\n  let d = sin(pos.x * di) * sin(pos.y * di) * sin(pos.z * di) * 0.1;\n\n  let a = SDF(\n    getColor(u32(abs(n + 0.5) * 0xFFFFFF)),\n    sdSphere(q + sin(id + time * 0.5) * (s * 0.5), s) + d\n  );\n  let b = SDF(\n    getColor(u32(abs(n - 0.5) * 0xFFFFFF)),\n    sdSphere(q - sin(id + time * sin(id.x + id.z) * 0.5) * (s * 0.5), s) - d\n  );\n  return opSmoothUnion(a, b, 1);\n}\n\nfn getColor(c : u32) -> vec3<f32> {\n  return vec3<f32>(\n    f32((c >> 16) & 0xFF) / 0xFF,\n    f32((c >> 8) & 0xFF) / 0xFF,\n    f32(c & 0xFF) / 0xFF,\n  );\n}\n","fn getScene(pos : vec3<f32>) -> SDF {\n  let q = pos - vec3<f32>(0, 0, -64);\n  let n = abs(FBM(q * (0.06 + sin(time * 0.5) * 0.01) - 0.2));\n  return SDF(\n    hsl2Rgb(vec3<f32>(n, 0.7, 0.5)),\n    sdSphere(q, 32 - n * 8)\n  );\n}\n\nfn FBM(p : vec3<f32>) -> f32 {\n  var value : f32;\n  var amplitude : f32 = 0.5;\n  var q : vec3<f32> = p;\n  for (var i : i32 = 0; i < 3; i++) {\n    value += SimplexNoise(q) * amplitude;\n    q *= 2;\n    amplitude *= 0.5;\n  }\n  return value;\n}\n"],pe={editor:null,errors:ie([]),source:ae("scene",de[0])},he={gpu:null,input:null,iterations:ae("iterations",300),mode:ae("mode","conetracing"),resolution:ae("resolution",.8)},me=e=>{if(1!==e.version)throw new Error("version");fe.editor=null,fe.source.set(e.effect),pe.editor=null,pe.source.set(e.scene),he.iterations.set(e.iterations),he.mode.set(e.mode),he.resolution.set(e.resolution),he.input&&he.input.reset()},ve=()=>{const e=new Blob([JSON.stringify({effect:a(fe.source),scene:a(pe.source),iterations:a(he.iterations),mode:a(he.mode),resolution:a(he.resolution),version:1})],{type:"application/json"}),t=new Date,n=e=>("00"+e).slice(-2);return{path:`marcher-${`${n(t.getMonth()+1)}${n(t.getDate())}`}${`${n(t.getHours())}${n(t.getMinutes())}`}.json`,content:e}},ge=()=>me({effect:ue[0],scene:de[0],iterations:300,mode:"conetracing",resolution:.8,version:1}),xe=()=>{const[e,t]=location.hash.slice(2).split("/")[0].split(":");"ipfs"===e&&t&&(ce.fetch.set(`ipfs://${t}`),ce.publish.set(!1),fetch(`https://ipfs.io/ipfs/${t}`).then((e=>e.json())).then((e=>{se=!0;try{me(e)}finally{se=!1}})).catch((e=>console.error(e))).finally((()=>ce.fetch.set(!1))))};function be(e,t,n){const o=e.slice();return o[11]=t[n].lineNum,o[12]=t[n].linePos,o[13]=t[n].type,o[14]=t[n].message,o[15]=t[n].line,o[16]=t[n].pointer,o}function ye(e){let t,n,o,r,i,s,a,c,l,u,f,d,p,h,x,w,k,F=e[11]+"",L=e[12]+"",D=e[13]+"",z=e[14]+"",E=e[15]+"",P=e[16]+"";return{c(){t=b("div"),n=b("div"),o=y(":"),r=y(F),i=y(":"),s=y(L),a=$(),c=y(D),l=y(": "),u=y(z),f=$(),d=b("div"),p=y(E),h=$(),x=b("div"),w=y(P),k=$(),S(n,"class","svelte-1s5oj1u"),S(d,"class","svelte-1s5oj1u"),S(x,"class","svelte-1s5oj1u"),S(t,"class","svelte-1s5oj1u")},m(e,g){v(e,t,g),m(t,n),m(n,o),m(n,r),m(n,i),m(n,s),m(n,a),m(n,c),m(n,l),m(n,u),m(t,f),m(t,d),m(d,p),m(t,h),m(t,x),m(x,w),m(t,k)},p(e,t){4&t&&F!==(F=e[11]+"")&&M(r,F),4&t&&L!==(L=e[12]+"")&&M(s,L),4&t&&D!==(D=e[13]+"")&&M(c,D),4&t&&z!==(z=e[14]+"")&&M(u,z),4&t&&E!==(E=e[15]+"")&&M(p,E),4&t&&P!==(P=e[16]+"")&&M(w,P)},d(e){e&&g(t)}}}function $e(t){let n,o,r,i,s,a,c,l,u,f,d,p,h,w,F=t[2].length+"",L=t[2],z=[];for(let e=0;e<L.length;e+=1)z[e]=ye(be(t,L,e));return{c(){n=b("div"),o=b("div"),r=$(),i=b("div"),s=b("div"),a=b("div"),c=$(),l=y(F),u=y(" errors\n      "),f=b("div"),d=$(),p=b("div");for(let e=0;e<z.length;e+=1)z[e].c();S(o,"class","wrapper svelte-1s5oj1u"),S(a,"class","status svelte-1s5oj1u"),D(a,"error",t[2].length),S(f,"class","arrow svelte-1s5oj1u"),S(s,"class","toggle svelte-1s5oj1u"),S(p,"class","messages svelte-1s5oj1u"),S(i,"class","errors svelte-1s5oj1u"),D(i,"open",t[1]),S(n,"class","editor svelte-1s5oj1u")},m(e,g){v(e,n,g),m(n,o),t[7](o),m(n,r),m(n,i),m(i,s),m(s,a),m(s,c),m(s,l),m(s,u),m(s,f),m(i,d),m(i,p);for(let e=0;e<z.length;e+=1)z[e].m(p,null);h||(w=k(s,"click",t[5]),h=!0)},p(e,[t]){if(4&t&&D(a,"error",e[2].length),4&t&&F!==(F=e[2].length+"")&&M(l,F),4&t){let n;for(L=e[2],n=0;n<L.length;n+=1){const o=be(e,L,n);z[n]?z[n].p(o,t):(z[n]=ye(o),z[n].c(),z[n].m(p,null))}for(;n<z.length;n+=1)z[n].d(1);z.length=L.length}2&t&&D(i,"open",e[1])},i:e,o:e,d(e){e&&g(n),t[7](null),x(z,e),h=!1,w()}}}function we(e,t,n){let o,r,{state:i}=t;const{errors:s,source:a}=i;let l,u;c(e,s,(e=>n(2,r=e))),c(e,a,(e=>n(9,o=e)));let f=!1;const d=()=>u.layout();return _((()=>{let e=null,t=!0,r=!1;if(u=monaco.editor.create(l,{minimap:{enabled:!1},theme:"vs-dark"}),i.editor){const{model:e,view:t}=i.editor;u.setModel(e),u.restoreViewState(t)}else u.setModel(monaco.editor.createModel(o,"c"));const c=[s.subscribe((e=>{monaco.editor.setModelMarkers(u.getModel(),"Errors",e.map((({lineNum:e,linePos:t,length:n,message:o})=>({message:o,startLineNumber:e,endLineNumber:e,startColumn:t,endColumn:t+n}))))})),a.subscribe((e=>{t||(r=!0,u.setValue(e),r=!1)}))];return t=!1,u.onDidChangeModelContent((()=>{r||(clearTimeout(e),e=setTimeout((()=>{t=!0,a.set(u.getValue()),t=!1}),300))})),u.focus(),window.addEventListener("resize",d,!1),()=>{n(6,i.editor={model:u.getModel(),view:u.saveViewState()},i),u.dispose(),clearTimeout(e),window.removeEventListener("resize",d),c.forEach((e=>e()))}})),e.$$set=e=>{"state"in e&&n(6,i=e.state)},[l,f,r,s,a,()=>{n(1,f=!f),I().then(d)},i,function(e){C[e?"unshift":"push"]((()=>{l=e,n(0,l)}))}]}window.addEventListener("hashchange",xe,!1),xe();class ke extends oe{constructor(e){super(),ne(this,e,we,$e,i,{state:6})}}function Se(t){let n,o;return n=new ke({props:{state:fe}}),{c(){Q(n.$$.fragment)},m(e,t){ee(n,e,t),o=!0},p:e,i(e){o||(K(n.$$.fragment,e),o=!0)},o(e){J(n.$$.fragment,e),o=!1},d(e){te(n,e)}}}class Me extends oe{constructor(e){super(),ne(this,e,null,Se,i,{})}}function Fe(e){let t,n,o,r;return{c(){t=b("div"),n=y("Fetching: "),o=b("span"),r=y(e[0]),S(o,"class","svelte-19cmddm"),S(t,"class","wrapper svelte-19cmddm")},m(e,i){v(e,t,i),m(t,n),m(t,o),m(o,r)},p(e,t){1&t&&M(r,e[0])},d(e){e&&g(t)}}}function Le(t){let n,o=t[0]&&Fe(t);return{c(){o&&o.c(),n=w()},m(e,t){o&&o.m(e,t),v(e,n,t)},p(e,[t]){e[0]?o?o.p(e,t):(o=Fe(e),o.c(),o.m(n.parentNode,n)):o&&(o.d(1),o=null)},i:e,o:e,d(e){o&&o.d(e),e&&g(n)}}}function De(e,t,n){let o;const{fetch:r}=ce;return c(e,r,(e=>n(0,o=e))),[o,r]}class ze extends oe{constructor(e){super(),ne(this,e,De,Le,i,{})}}function Ee(e){let t;const n=e[4].default,o=l(n,e,e[3],null);return{c(){o&&o.c()},m(e,n){o&&o.m(e,n),t=!0},p(e,r){o&&o.p&&(!t||8&r)&&d(o,n,e,e[3],t?f(n,e[3],r,null):p(e[3]),null)},i(e){t||(K(o,e),t=!0)},o(e){J(o,e),t=!1},d(e){o&&o.d(e)}}}function Pe(t){let n;return{c(){n=y("Copied!")},m(e,t){v(e,n,t)},p:e,i:e,o:e,d(e){e&&g(n)}}}function _e(e){let t,n,o,r,i,s;const a=[Pe,Ee],c=[];function l(e,t){return e[0]?0:1}return n=l(e),o=c[n]=a[n](e),{c(){t=b("button"),o.c(),S(t,"class","svelte-1ngxztk")},m(o,a){v(o,t,a),c[n].m(t,null),r=!0,i||(s=k(t,"click",e[1]),i=!0)},p(e,[r]){let i=n;n=l(e),n===i?c[n].p(e,r):(H(),J(c[i],1,1,(()=>{c[i]=null})),X(),o=c[n],o?o.p(e,r):(o=c[n]=a[n](e),o.c()),K(o,1),o.m(t,null))},i(e){r||(K(o),r=!0)},o(e){J(o),r=!1},d(e){e&&g(t),c[n].d(),i=!1,s()}}}function qe(e,t,n){let{$$slots:o={},$$scope:r}=t,{text:i}=t,s=!1,a=null;var c;return c=()=>clearTimeout(a),P().$$.on_destroy.push(c),e.$$set=e=>{"text"in e&&n(2,i=e.text),"$$scope"in e&&n(3,r=e.$$scope)},[s,()=>{navigator.clipboard.writeText(i),n(0,s=!0),clearTimeout(a),a=setTimeout((()=>{n(0,s=!1)}),1e3)},i,r,o]}class Ce extends oe{constructor(e){super(),ne(this,e,qe,_e,i,{text:2})}}function Te(e){let t,n,o,r,i;const s=e[5].default,a=l(s,e,e[4],null);return{c(){t=b("div"),n=b("div"),a&&a.c(),S(n,"class","wrapper svelte-1a9s5rp"),S(t,"class","overlay svelte-1a9s5rp")},m(s,c){v(s,t,c),m(t,n),a&&a.m(n,null),e[6](t),o=!0,r||(i=k(t,"mousedown",e[3]),r=!0)},p(e,t){a&&a.p&&(!o||16&t)&&d(a,s,e,e[4],o?f(s,e[4],t,null):p(e[4]),null)},i(e){o||(K(a,e),o=!0)},o(e){J(a,e),o=!1},d(n){n&&g(t),a&&a.d(n),e[6](null),r=!1,i()}}}function je(e){let t,n,o=e[2]&&Te(e);return{c(){o&&o.c(),t=w()},m(e,r){o&&o.m(e,r),v(e,t,r),n=!0},p(e,[n]){e[2]?o?(o.p(e,n),4&n&&K(o,1)):(o=Te(e),o.c(),K(o,1),o.m(t.parentNode,t)):o&&(H(),J(o,1,1,(()=>{o=null})),X())},i(e){n||(K(o),n=!0)},o(e){J(o),n=!1},d(e){o&&o.d(e),e&&g(t)}}}function Re(t,n,o){let r,i=e,a=()=>(i(),i=s(f,(e=>o(2,r=e))),f);t.$$.on_destroy.push((()=>i()));let c,{$$slots:l={},$$scope:u}=n,{state:f}=n;a();return t.$$set=e=>{"state"in e&&a(o(0,f=e.state)),"$$scope"in e&&o(4,u=e.$$scope)},[f,c,r,({target:e})=>{e===c&&h(f,r=!1,r)},u,l,function(e){C[e?"unshift":"push"]((()=>{c=e,o(1,c)}))}]}class Be extends oe{constructor(e){super(),ne(this,e,Re,je,i,{state:0})}}let Ue;function Ie(t){return{c:e,m:e,p:e,i:e,o:e,d:e}}function Ne(e){let t,n,o,r,i,s,a,c,l=e[1]+"";return a=new Ce({props:{text:e[1],$$slots:{default:[Ae]},$$scope:{ctx:e}}}),{c(){t=b("div"),t.textContent="Successfully published!",n=$(),o=b("div"),r=y(l),i=$(),s=b("div"),Q(a.$$.fragment),S(t,"class","heading svelte-vcks90"),S(o,"class","link svelte-vcks90"),S(s,"class","actions svelte-vcks90")},m(e,l){v(e,t,l),v(e,n,l),v(e,o,l),m(o,r),v(e,i,l),v(e,s,l),ee(a,s,null),c=!0},p(e,t){const n={};4&t&&(n.$$scope={dirty:t,ctx:e}),a.$set(n)},i(e){c||(K(a.$$.fragment,e),c=!0)},o(e){J(a.$$.fragment,e),c=!1},d(e){e&&g(t),e&&g(n),e&&g(o),e&&g(i),e&&g(s),te(a)}}}function Ae(e){let t;return{c(){t=y("Copy link")},m(e,n){v(e,t,n)},d(e){e&&g(t)}}}function Oe(t){let n;return{c(){n=b("div"),n.textContent="Publishing...",S(n,"class","heading svelte-vcks90")},m(e,t){v(e,n,t)},p:e,i:e,o:e,d(e){e&&g(n)}}}function Ge(e){let t,n,o={ctx:e,current:null,token:null,hasCatch:!1,pending:Oe,then:Ne,catch:Ie,value:1,blocks:[,,,]};return function(e,t){const n=t.token={};function o(e,o,r,i){if(t.token!==n)return;t.resolved=i;let s=t.ctx;void 0!==r&&(s=s.slice(),s[r]=i);const a=e&&(t.current=e)(s);let c=!1;t.block&&(t.blocks?t.blocks.forEach(((e,n)=>{n!==o&&e&&(H(),J(e,1,1,(()=>{t.blocks[n]===e&&(t.blocks[n]=null)})),X())})):t.block.d(1),a.c(),K(a,1),a.m(t.mount(),t.anchor),c=!0),t.block=a,t.blocks&&(t.blocks[o]=a),c&&G()}if((r=e)&&"object"==typeof r&&"function"==typeof r.then){const n=P();if(e.then((e=>{E(n),o(t.then,1,t.value,e),E(null)}),(e=>{if(E(n),o(t.catch,2,t.error,e),E(null),!t.hasCatch)throw e})),t.current!==t.pending)return o(t.pending,0),!0}else{if(t.current!==t.then)return o(t.then,1,t.value,e),!0;t.resolved=e}var r}(e[0](),o),{c(){t=w(),o.block.c()},m(e,r){v(e,t,r),o.block.m(e,o.anchor=r),o.mount=()=>t.parentNode,o.anchor=t,n=!0},p(t,n){!function(e,t,n){const o=t.slice(),{resolved:r}=e;e.current===e.then&&(o[e.value]=r),e.current===e.catch&&(o[e.error]=r),e.block.p(o,n)}(o,e=t,n)},i(e){n||(K(o.block),n=!0)},o(e){for(let e=0;e<3;e+=1){J(o.blocks[e])}n=!1},d(e){e&&g(t),o.block.d(e),o.token=null,o=null}}}function Ve(e){let t,n;return t=new Be({props:{state:ce.publish,$$slots:{default:[Ge]},$$scope:{ctx:e}}}),{c(){Q(t.$$.fragment)},m(e,o){ee(t,e,o),n=!0},p(e,[n]){const o={};4&n&&(o.$$scope={dirty:n,ctx:e}),t.$set(o)},i(e){n||(K(t.$$.fragment,e),n=!0)},o(e){J(t.$$.fragment,e),n=!1},d(e){te(t,e)}}}function We(e){return[()=>(Ue?Promise.resolve(Ue):new Promise(((e,t)=>{const n=document.createElement("script");n.onload=e,n.onerror=t,n.src="https://cdn.jsdelivr.net/npm/ipfs-core@0.16.0/dist/index.min.js",document.head.appendChild(n)})).then((()=>window.IpfsCore.create({repo:String(Math.random()+Date.now()),init:{alogorithm:"ed25519"}}))).then((e=>(Ue=e,e)))).then((e=>e.add(ve()))).then((e=>{fetch(`https://ipfs.io/ipfs/${e.cid}`).catch((()=>{}));const t=new URL(location);return t.hash=`#/ipfs:${e.cid}`,t.toString()})).catch((e=>console.error(e)))]}class Ye extends oe{constructor(e){super(),ne(this,e,We,Ve,i,{})}}function He(t){let n,o;return n=new ke({props:{state:pe}}),{c(){Q(n.$$.fragment)},m(e,t){ee(n,e,t),o=!0},p:e,i(e){o||(K(n.$$.fragment,e),o=!0)},o(e){J(n.$$.fragment,e),o=!1},d(e){te(n,e)}}}class Xe extends oe{constructor(e){super(),ne(this,e,null,He,i,{})}}function Ke(t){let n,o,r;return{c(){n=b("input"),S(n,"type","number"),S(n,"id",t[0]),S(n,"max",t[1]),S(n,"min",t[2]),S(n,"step",t[3]),n.value=t[5],S(n,"class","svelte-io5ur8")},m(e,i){v(e,n,i),o||(r=k(n,"input",t[6]),o=!0)},p(e,[t]){1&t&&S(n,"id",e[0]),2&t&&S(n,"max",e[1]),4&t&&S(n,"min",e[2]),8&t&&S(n,"step",e[3]),32&t&&n.value!==e[5]&&(n.value=e[5])},i:e,o:e,d(e){e&&g(n),o=!1,r()}}}function Je(t,n,o){let r,i=e,a=()=>(i(),i=s(d,(e=>o(5,r=e))),d);t.$$.on_destroy.push((()=>i()));let{id:c}=n,{max:l}=n,{min:u}=n,{step:f}=n,{state:d}=n;a();return t.$$set=e=>{"id"in e&&o(0,c=e.id),"max"in e&&o(1,l=e.max),"min"in e&&o(2,u=e.min),"step"in e&&o(3,f=e.step),"state"in e&&a(o(4,d=e.state))},[c,l,u,f,d,r,({target:{value:e}})=>{h(d,r=parseInt(e,10),r)}]}class Ze extends oe{constructor(e){super(),ne(this,e,Je,Ke,i,{id:0,max:1,min:2,step:3,state:4})}}function Qe(t){let n,o,r;return{c(){n=b("input"),S(n,"type","range"),S(n,"id",t[0]),S(n,"max",t[1]),S(n,"min",t[2]),S(n,"step",t[3]),n.value=t[5],S(n,"class","svelte-1h3mesz")},m(e,i){v(e,n,i),o||(r=k(n,"input",t[6]),o=!0)},p(e,[t]){1&t&&S(n,"id",e[0]),2&t&&S(n,"max",e[1]),4&t&&S(n,"min",e[2]),8&t&&S(n,"step",e[3]),32&t&&(n.value=e[5])},i:e,o:e,d(e){e&&g(n),o=!1,r()}}}function et(t,n,o){let r,i=e,a=()=>(i(),i=s(d,(e=>o(5,r=e))),d);t.$$.on_destroy.push((()=>i()));let{id:c}=n,{max:l}=n,{min:u}=n,{step:f}=n,{state:d}=n;a();return t.$$set=e=>{"id"in e&&o(0,c=e.id),"max"in e&&o(1,l=e.max),"min"in e&&o(2,u=e.min),"step"in e&&o(3,f=e.step),"state"in e&&a(o(4,d=e.state))},[c,l,u,f,d,r,({target:{value:e}})=>{h(d,r=parseFloat(e),r)}]}class tt extends oe{constructor(e){super(),ne(this,e,et,Qe,i,{id:0,max:1,min:2,step:3,state:4})}}function nt(e,t,n){const o=e.slice();return o[2]=t[n].id,o[5]=t[n].name,o}function ot(e){let t,n,o,r=e[5]+"";return{c(){t=b("option"),n=y(r),t.__value=o=e[2],t.value=t.__value},m(e,o){v(e,t,o),m(t,n)},p(e,i){1&i&&r!==(r=e[5]+"")&&M(n,r),1&i&&o!==(o=e[2])&&(t.__value=o,t.value=t.__value)},d(e){e&&g(t)}}}function rt(t){let n,o,r,i=t[0],s=[];for(let e=0;e<i.length;e+=1)s[e]=ot(nt(t,i,e));return{c(){n=b("select");for(let e=0;e<s.length;e+=1)s[e].c();S(n,"id",t[2]),S(n,"class","svelte-146trro"),void 0===t[3]&&N((()=>t[4].call(n)))},m(e,i){v(e,n,i);for(let e=0;e<s.length;e+=1)s[e].m(n,null);L(n,t[3]),o||(r=k(n,"change",t[4]),o=!0)},p(e,[t]){if(1&t){let o;for(i=e[0],o=0;o<i.length;o+=1){const r=nt(e,i,o);s[o]?s[o].p(r,t):(s[o]=ot(r),s[o].c(),s[o].m(n,null))}for(;o<s.length;o+=1)s[o].d(1);s.length=i.length}4&t&&S(n,"id",e[2]),9&t&&L(n,e[3])},i:e,o:e,d(e){e&&g(n),x(s,e),o=!1,r()}}}function it(t,n,o){let r,i=e,a=()=>(i(),i=s(u,(e=>o(3,r=e))),u);t.$$.on_destroy.push((()=>i()));let{id:c}=n,{options:l}=n,{state:u}=n;return a(),t.$$set=e=>{"id"in e&&o(2,c=e.id),"options"in e&&o(0,l=e.options),"state"in e&&a(o(1,u=e.state))},[l,u,c,r,function(){r=function(e){const t=e.querySelector(":checked")||e.options[0];return t&&t.__value}(this),u.set(r),o(0,l)}]}class st extends oe{constructor(e){super(),ne(this,e,it,rt,i,{id:2,options:0,state:1})}}function at(e,t,n){const o=e.slice();return o[6]=t[n].id,o[7]=t[n].name,o}function ct(e,t,n){const o=e.slice();return o[7]=t[n].name,o[10]=t[n].items,o}function lt(e,t,n){const o=e.slice();return o[13]=t[n],o}function ut(t){let n,o,r=t[13]+"";return{c(){n=b("div"),o=y(r)},m(e,t){v(e,n,t),m(n,o)},p:e,d(e){e&&g(n)}}}function ft(e){let t,n,o,r,i,s,a=e[7]+"",c=e[10],l=[];for(let t=0;t<c.length;t+=1)l[t]=ut(lt(e,c,t));return{c(){t=b("div"),n=b("div"),o=y(a),r=$(),i=b("div");for(let e=0;e<l.length;e+=1)l[e].c();s=$(),S(n,"class","svelte-13z9b40"),S(i,"class","svelte-13z9b40"),S(t,"class","svelte-13z9b40")},m(e,a){v(e,t,a),m(t,n),m(n,o),m(t,r),m(t,i);for(let e=0;e<l.length;e+=1)l[e].m(i,null);m(t,s)},p(e,t){if(32&t){let n;for(c=e[10],n=0;n<c.length;n+=1){const o=lt(e,c,n);l[n]?l[n].p(o,t):(l[n]=ut(o),l[n].c(),l[n].m(i,null))}for(;n<l.length;n+=1)l[n].d(1);l.length=c.length}},d(e){e&&g(t),x(l,e)}}}function dt(t){let n,o,r,i,s,a,c,l=t[6]+"",u=t[7]+"";return{c(){n=b("div"),o=b("div"),r=y(l),i=$(),s=b("div"),a=y(u),c=$(),S(o,"class","svelte-13z9b40"),S(s,"class","svelte-13z9b40"),S(n,"class","svelte-13z9b40")},m(e,t){v(e,n,t),m(n,o),m(o,r),m(n,i),m(n,s),m(s,a),m(n,c)},p:e,d(e){e&&g(n)}}}function pt(e){let t,n,o,r,i,s,a,c,l,u,f,d,p,h,y,w,k,M,F,L,D,z,E,P;i=new tt({props:{id:"resolution",state:e[2],step:.2,min:.2,max:1}}),u=new st({props:{id:"mode",options:e[4],state:e[1]}}),y=new Ze({props:{id:"iterations",state:e[0],step:100,min:100,max:1e3}});let _=e[5],q=[];for(let t=0;t<_.length;t+=1)q[t]=ft(ct(e,_,t));let C=e[3],T=[];for(let t=0;t<C.length;t+=1)T[t]=dt(at(e,C,t));return{c(){t=b("div"),n=b("div"),o=b("label"),o.textContent="Resolution:",r=$(),Q(i.$$.fragment),s=$(),a=b("div"),c=b("label"),c.textContent="Mode:",l=$(),Q(u.$$.fragment),f=$(),d=b("div"),p=b("label"),p.textContent="Max iterations:",h=$(),Q(y.$$.fragment),w=$(),k=b("div"),k.textContent="Reference",M=$(),F=b("div");for(let e=0;e<q.length;e+=1)q[e].c();L=$(),D=b("div"),D.textContent="Controls",z=$(),E=b("div");for(let e=0;e<T.length;e+=1)T[e].c();S(o,"for","resolution"),S(o,"class","svelte-13z9b40"),S(n,"class","input svelte-13z9b40"),S(c,"for","mode"),S(c,"class","svelte-13z9b40"),S(a,"class","input svelte-13z9b40"),S(p,"for","iterations"),S(p,"class","svelte-13z9b40"),S(d,"class","input svelte-13z9b40"),S(k,"class","heading svelte-13z9b40"),S(F,"class","reference svelte-13z9b40"),S(D,"class","heading svelte-13z9b40"),S(E,"class","controls svelte-13z9b40"),S(t,"class","wrapper svelte-13z9b40")},m(e,g){v(e,t,g),m(t,n),m(n,o),m(n,r),ee(i,n,null),m(t,s),m(t,a),m(a,c),m(a,l),ee(u,a,null),m(t,f),m(t,d),m(d,p),m(d,h),ee(y,d,null),m(t,w),m(t,k),m(t,M),m(t,F);for(let e=0;e<q.length;e+=1)q[e].m(F,null);m(t,L),m(t,D),m(t,z),m(t,E);for(let e=0;e<T.length;e+=1)T[e].m(E,null);P=!0},p(e,[t]){if(32&t){let n;for(_=e[5],n=0;n<_.length;n+=1){const o=ct(e,_,n);q[n]?q[n].p(o,t):(q[n]=ft(o),q[n].c(),q[n].m(F,null))}for(;n<q.length;n+=1)q[n].d(1);q.length=_.length}if(8&t){let n;for(C=e[3],n=0;n<C.length;n+=1){const o=at(e,C,n);T[n]?T[n].p(o,t):(T[n]=dt(o),T[n].c(),T[n].m(E,null))}for(;n<T.length;n+=1)T[n].d(1);T.length=C.length}},i(e){P||(K(i.$$.fragment,e),K(u.$$.fragment,e),K(y.$$.fragment,e),P=!0)},o(e){J(i.$$.fragment,e),J(u.$$.fragment,e),J(y.$$.fragment,e),P=!1},d(e){e&&g(t),te(i),te(u),te(y),x(q,e),x(T,e)}}}function ht(e){const{iterations:t,mode:n,resolution:o}=he;return[t,n,o,[{id:"W",name:"Move forwards"},{id:"A",name:"Move leftwards"},{id:"S",name:"Move backwards"},{id:"D",name:"Move rightwards"},{id:"Q",name:"Move downwards"},{id:"E",name:"Move upwards"},{id:"R",name:"Reset camera"},{id:"Shift",name:"Double movement speed"},{id:"Wheel",name:"Set movement speed"}],[{id:"conetracing",name:"Conetracing (better antialiasing)"},{id:"raymarching",name:"Raymarching (better performance)"}],[{name:"Color",items:["fn hsl2Rgb(hsl : vec3<f32>) -> vec3<f32>"]},{name:"Light",items:["struct Light { position : vec3<f32>, diffuse : vec3<f32>, specular : vec3<f32> }","fn getAttenuation(dist : f32, constant : f32, linear : f32, quadratic : f32) -> f32","fn getDirectLight(light : Light, normal : vec3<f32>, position : vec3<f32>, shininess : f32) -> vec3<f32>"]},{name:"Noise",items:["fn SimplexNoise(v : vec3<f32>) -> f32"]},{name:"Rotation",items:["const PI : f32","fn rotateX(radians : f32) -> mat3x3<f32>","fn rotateY(radians : f32) -> mat3x3<f32>","fn rotateZ(radians : f32) -> mat3x3<f32>","fn spherical(phi : f32, theta : f32, radius : f32) -> vec3<f32>"]},{name:"SDF",items:["struct SDF { color : vec3<f32>, distance : f32 }","fn opUnion(a : SDF, b : SDF) -> SDF","fn opSubstraction(a : SDF, b : SDF) -> SDF","fn opSmoothUnion(a : SDF, b : SDF, k : f32) -> SDF","fn opSmoothSubstraction(a : SDF, b : SDF, k : f32) -> SDF","fn sdBox(p : vec3<f32>, r : vec3<f32>) -> f32","fn sdCapsule(p : vec3<f32>, r : vec2<f32>) -> f32","fn sdEllipsoid(p : vec3<f32>, r : vec3<f32>) -> f32","fn sdPlane(p : vec3<f32>, n : vec3<f32>, h : f32) -> f32","fn sdSphere(p : vec3<f32>, r : f32) -> f32","fn sdTorus(p : vec3<f32>, r : vec2<f32>) -> f32"]},{name:"Uniforms",items:["struct Camera {","inverseMatrix : mat4x4<f32>,","position : vec3<f32>,","direction : vec3<f32>,","cone : f32,","near : f32,","far : f32,","}","var<uniform> camera : Camera;","var<uniform> time : f32;"]}]]}class mt extends oe{constructor(e){super(),ne(this,e,ht,pt,i,{})}}const vt=e=>({}),gt=e=>({}),xt=e=>({}),bt=e=>({});function yt(e){let t,n,o,r;const i=e[1].toggle,s=l(i,e,e[0],bt),a=e[1].options,c=l(a,e,e[0],gt);return{c(){t=b("div"),s&&s.c(),n=$(),o=b("div"),c&&c.c(),S(o,"class","options svelte-7xzgh1"),S(t,"class","dropdown svelte-7xzgh1")},m(e,i){v(e,t,i),s&&s.m(t,null),m(t,n),m(t,o),c&&c.m(o,null),r=!0},p(e,[t]){s&&s.p&&(!r||1&t)&&d(s,i,e,e[0],r?f(i,e[0],t,xt):p(e[0]),bt),c&&c.p&&(!r||1&t)&&d(c,a,e,e[0],r?f(a,e[0],t,vt):p(e[0]),gt)},i(e){r||(K(s,e),K(c,e),r=!0)},o(e){J(s,e),J(c,e),r=!1},d(e){e&&g(t),s&&s.d(e),c&&c.d(e)}}}function $t(e,t,n){let{$$slots:o={},$$scope:r}=t;return e.$$set=e=>{"$$scope"in e&&n(0,r=e.$$scope)},[r,o]}class wt extends oe{constructor(e){super(),ne(this,e,$t,yt,i,{})}}function kt(t){let n;return{c(){n=b("div"),n.innerHTML='<div class="arrow svelte-17k7bjm"></div> \n    <div class="label svelte-17k7bjm">File</div>',S(n,"class","toggle svelte-17k7bjm"),S(n,"slot","toggle")},m(e,t){v(e,n,t)},p:e,d(e){e&&g(n)}}}function St(t){let n,r,i,s,a,c,l,u,f;return{c(){n=b("div"),n.textContent="New",r=$(),i=b("div"),i.textContent="Import",s=$(),a=b("div"),a.textContent="Export",c=$(),l=b("div"),l.textContent="Publish",S(n,"class","action svelte-17k7bjm"),S(i,"class","action svelte-17k7bjm"),S(a,"class","action svelte-17k7bjm"),S(l,"class","action svelte-17k7bjm")},m(e,o){v(e,n,o),v(e,r,o),v(e,i,o),v(e,s,o),v(e,a,o),v(e,c,o),v(e,l,o),u||(f=[k(n,"click",ge),k(i,"click",t[3]),k(a,"click",t[2]),k(l,"click",t[5])],u=!0)},p:e,d(e){e&&g(n),e&&g(r),e&&g(i),e&&g(s),e&&g(a),e&&g(c),e&&g(l),u=!1,o(f)}}}function Mt(e){let t,n,r,i,s,a,c,l,u;return a=new wt({props:{$$slots:{options:[St],toggle:[kt]},$$scope:{ctx:e}}}),{c(){t=b("div"),n=b("a"),r=$(),i=b("input"),s=$(),Q(a.$$.fragment),S(i,"type","file"),S(i,"accept","application/json"),S(t,"class","helpers svelte-17k7bjm")},m(o,f){v(o,t,f),m(t,n),e[7](n),m(t,r),m(t,i),e[8](i),v(o,s,f),ee(a,o,f),c=!0,l||(u=[k(window,"dragenter",e[4]),k(window,"dragover",e[4]),k(window,"drop",e[6]),k(i,"change",e[6])],l=!0)},p(e,[t]){const n={};512&t&&(n.$$scope={dirty:t,ctx:e}),a.$set(n)},i(e){c||(K(a.$$.fragment,e),c=!0)},o(e){J(a.$$.fragment,e),c=!1},d(n){n&&g(t),e[7](null),e[8](null),n&&g(s),te(a,n),l=!1,o(u)}}}function Ft(e,t,n){let o,r;const i=e=>e.preventDefault();return[o,r,()=>{const{content:e,path:t}=ve();URL.revokeObjectURL(o.href),n(0,o.download=t,o),n(0,o.href=URL.createObjectURL(e),o),o.click()},()=>r.click(),i,()=>ce.publish.set(!0),e=>{i(e);const[t]=e.dataTransfer?e.dataTransfer.files:e.target.files;if(!t)return;const o=new FileReader;o.addEventListener("load",(()=>{n(1,r.value=null,r),me(JSON.parse(o.result))}),!1),o.readAsText(t)},function(e){C[e?"unshift":"push"]((()=>{o=e,n(0,o)}))},function(e){C[e?"unshift":"push"]((()=>{r=e,n(1,r)}))}]}class Lt extends oe{constructor(e){super(),ne(this,e,Ft,Mt,i,{})}}function Dt(e,t,n){const o=e.slice();return o[7]=t[n],o[9]=n,o}function zt(e,t,n){const o=e.slice();return o[7]=t[n],o[9]=n,o}function Et(e,t,n){const o=e.slice();return o[11]=t[n].id,o[12]=t[n].name,o}function Pt(e){let t,n,o,r,i,s=e[12]+"";return{c(){t=b("div"),n=y(s),o=$(),S(t,"class","view svelte-7njirj"),D(t,"enabled",e[0]===e[11])},m(s,a){v(s,t,a),m(t,n),m(t,o),r||(i=k(t,"click",e[4](e[11])),r=!0)},p(n,o){e=n,3&o&&D(t,"enabled",e[0]===e[11])},d(e){e&&g(t),r=!1,i()}}}function _t(e){let t,n;return t=new wt({props:{$$slots:{options:[Bt],toggle:[qt]},$$scope:{ctx:e}}}),{c(){Q(t.$$.fragment)},m(e,o){ee(t,e,o),n=!0},p(e,n){const o={};32769&n&&(o.$$scope={dirty:n,ctx:e}),t.$set(o)},i(e){n||(K(t.$$.fragment,e),n=!0)},o(e){J(t.$$.fragment,e),n=!1},d(e){te(t,e)}}}function qt(t){let n;return{c(){n=b("div"),n.innerHTML='<div class="label svelte-7njirj">Examples</div> \n          <div class="arrow svelte-7njirj"></div>',S(n,"class","toggle svelte-7njirj"),S(n,"slot","toggle")},m(e,t){v(e,n,t)},p:e,d(e){e&&g(n)}}}function Ct(e){let t,n=ue,o=[];for(let t=0;t<n.length;t+=1)o[t]=jt(Dt(e,n,t));return{c(){for(let e=0;e<o.length;e+=1)o[e].c();t=w()},m(e,n){for(let t=0;t<o.length;t+=1)o[t].m(e,n);v(e,t,n)},p(e,r){if(4&r){let i;for(n=ue,i=0;i<n.length;i+=1){const s=Dt(e,n,i);o[i]?o[i].p(s,r):(o[i]=jt(s),o[i].c(),o[i].m(t.parentNode,t))}for(;i<o.length;i+=1)o[i].d(1);o.length=n.length}},d(e){x(o,e),e&&g(t)}}}function Tt(e){let t,n=de,o=[];for(let t=0;t<n.length;t+=1)o[t]=Rt(zt(e,n,t));return{c(){for(let e=0;e<o.length;e+=1)o[e].c();t=w()},m(e,n){for(let t=0;t<o.length;t+=1)o[t].m(e,n);v(e,t,n)},p(e,r){if(8&r){let i;for(n=de,i=0;i<n.length;i+=1){const s=zt(e,n,i);o[i]?o[i].p(s,r):(o[i]=Rt(s),o[i].c(),o[i].m(t.parentNode,t))}for(;i<o.length;i+=1)o[i].d(1);o.length=n.length}},d(e){x(o,e),e&&g(t)}}}function jt(e){let t,n,o,r,i,s,a=e[9]+1+"";return{c(){t=b("div"),n=y("Effect "),o=y(a),r=$(),S(t,"class","action svelte-7njirj")},m(a,c){v(a,t,c),m(t,n),m(t,o),m(t,r),i||(s=k(t,"click",e[2](e[7])),i=!0)},p(t,n){e=t},d(e){e&&g(t),i=!1,s()}}}function Rt(e){let t,n,o,r,i,s,a=e[9]+1+"";return{c(){t=b("div"),n=y("Scene "),o=y(a),r=$(),S(t,"class","action svelte-7njirj")},m(a,c){v(a,t,c),m(t,n),m(t,o),m(t,r),i||(s=k(t,"click",e[3](e[7])),i=!0)},p(t,n){e=t},d(e){e&&g(t),i=!1,s()}}}function Bt(e){let t;function n(e,t){return"scene"===e[0]?Tt:"effect"===e[0]?Ct:void 0}let o=n(e),r=o&&o(e);return{c(){r&&r.c(),t=w()},m(e,n){r&&r.m(e,n),v(e,t,n)},p(e,i){o===(o=n(e))&&r?r.p(e,i):(r&&r.d(1),r=o&&o(e),r&&(r.c(),r.m(t.parentNode,t)))},d(e){r&&r.d(e),e&&g(t)}}}function Ut(e){let t,n,o,r,i,s,a;o=new Lt({});let c=e[1],l=[];for(let t=0;t<c.length;t+=1)l[t]=Pt(Et(e,c,t));let u="settings"!==e[0]&&_t(e);return{c(){t=b("div"),n=b("div"),Q(o.$$.fragment),r=$();for(let e=0;e<l.length;e+=1)l[e].c();i=$(),s=b("div"),u&&u.c(),S(n,"class","svelte-7njirj"),S(s,"class","svelte-7njirj"),S(t,"class","toolbar svelte-7njirj")},m(e,c){v(e,t,c),m(t,n),ee(o,n,null),m(n,r);for(let e=0;e<l.length;e+=1)l[e].m(n,null);m(t,i),m(t,s),u&&u.m(s,null),a=!0},p(e,[t]){if(19&t){let o;for(c=e[1],o=0;o<c.length;o+=1){const r=Et(e,c,o);l[o]?l[o].p(r,t):(l[o]=Pt(r),l[o].c(),l[o].m(n,null))}for(;o<l.length;o+=1)l[o].d(1);l.length=c.length}"settings"!==e[0]?u?(u.p(e,t),1&t&&K(u,1)):(u=_t(e),u.c(),K(u,1),u.m(s,null)):u&&(H(),J(u,1,1,(()=>{u=null})),X())},i(e){a||(K(o.$$.fragment,e),K(u),a=!0)},o(e){J(o.$$.fragment,e),J(u),a=!1},d(e){e&&g(t),te(o),x(l,e),u&&u.d()}}}function It(e,t,n){let o;c(e,le,(e=>n(0,o=e)));return[o,[{id:"scene",name:"Scene"},{id:"effect",name:"Effect"},{id:"settings",name:"Settings"}],e=>()=>{fe.editor=null,fe.source.set(e)},e=>()=>{pe.editor=null,pe.source.set(e),he.input.reset()},e=>()=>{h(le,o=e,o)}]}class Nt extends oe{constructor(e){super(),ne(this,e,It,Ut,i,{})}}var At=1e-6,Ot="undefined"!=typeof Float32Array?Float32Array:Array,Gt=Math.PI/180;function Vt(e){return e*Gt}function Wt(){var e=new Ot(16);return Ot!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0),e[0]=1,e[5]=1,e[10]=1,e[15]=1,e}Math.hypot||(Math.hypot=function(){for(var e=0,t=arguments.length;t--;)e+=arguments[t]*arguments[t];return Math.sqrt(e)});var Yt=function(e,t,n,o,r){var i,s=1/Math.tan(t/2);return e[0]=s/n,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=s,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,null!=r&&r!==1/0?(i=1/(o-r),e[10]=(r+o)*i,e[14]=2*r*o*i):(e[10]=-1,e[14]=-2*o),e};function Ht(){var e=new Ot(3);return Ot!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e}function Xt(e,t,n){var o=new Ot(3);return o[0]=e,o[1]=t,o[2]=n,o}function Kt(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}function Jt(e,t,n,o){return e[0]=t,e[1]=n,e[2]=o,e}function Zt(e,t,n,o){return e[0]=t[0]+n[0]*o,e[1]=t[1]+n[1]*o,e[2]=t[2]+n[2]*o,e}function Qt(e,t){var n=t[0],o=t[1],r=t[2],i=n*n+o*o+r*r;return i>0&&(i=1/Math.sqrt(i)),e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e}function en(e){return e[0]=0,e[1]=0,e[2]=0,e}var tn=function(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2],e};function nn(){var e=new Ot(2);return Ot!=Float32Array&&(e[0]=0,e[1]=0),e}function on(e,t){var n=new Ot(2);return n[0]=e,n[1]=t,n}function rn(e,t){return e[0]=t[0],e[1]=t[1],e}function sn(e,t,n){return e[0]=t,e[1]=n,e}Ht(),function(){var e=nn()}();const an=Xt(0,1,0);class cn{constructor({device:e,aspect:t=1,fov:n=75,near:o=.1,far:r=1e4}){this.device=e,this.data=new Float32Array(26),this.buffer=e.createBuffer({size:this.data.byteLength+Float32Array.BYTES_PER_ELEMENT,usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.UNIFORM}),this.aspect=t,this.fov=n,this.near=o,this.far=r,this.inverseMatrix=this.data.subarray(0,16),this.position=this.data.subarray(16,19),this.direction=this.data.subarray(20,23),this.cone=this.data.subarray(23,24),this.data[24]=o,this.data[25]=r,this.projectionMatrix=Wt(),this.viewMatrix=Wt(),this.target=Ht()}setSize(e,t){const{fov:n}=this;this.aspect=e/t,this.cone[0]=2*Math.tan(Vt(n)/2)/t,this.updateProjection()}updateProjection(){const{projectionMatrix:e,aspect:t,fov:n,near:o,far:r}=this;Yt(e,Vt(n),t,o,r),this.updateBuffer()}updateView(){const{viewMatrix:e,direction:t,position:n,target:o}=this;var r,i,s,a,c,l,u,f,d,p,h,m,v,g,x,b,y,$,w,k,S,M,F;Qt(t,tn(t,o,n)),r=e,s=o,a=an,x=(i=n)[0],b=i[1],y=i[2],$=a[0],w=a[1],k=a[2],S=s[0],M=s[1],F=s[2],Math.abs(x-S)<At&&Math.abs(b-M)<At&&Math.abs(y-F)<At?function(e){e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1}(r):(h=x-S,m=b-M,v=y-F,c=w*(v*=g=1/Math.hypot(h,m,v))-k*(m*=g),l=k*(h*=g)-$*v,u=$*m-w*h,(g=Math.hypot(c,l,u))?(c*=g=1/g,l*=g,u*=g):(c=0,l=0,u=0),f=m*u-v*l,d=v*c-h*u,p=h*l-m*c,(g=Math.hypot(f,d,p))?(f*=g=1/g,d*=g,p*=g):(f=0,d=0,p=0),r[0]=c,r[1]=f,r[2]=h,r[3]=0,r[4]=l,r[5]=d,r[6]=m,r[7]=0,r[8]=u,r[9]=p,r[10]=v,r[11]=0,r[12]=-(c*x+l*b+u*y),r[13]=-(f*x+d*b+p*y),r[14]=-(h*x+m*b+v*y),r[15]=1),this.updateBuffer()}updateBuffer(){const{buffer:e,data:t,device:n,projectionMatrix:o,viewMatrix:r,inverseMatrix:i}=this;var s,a,c,l,u,f,d,p,h,m,v,g,x,b,y,$,w,k,S,M,F,L,D;!function(e,t){var n=t[0],o=t[1],r=t[2],i=t[3],s=t[4],a=t[5],c=t[6],l=t[7],u=t[8],f=t[9],d=t[10],p=t[11],h=t[12],m=t[13],v=t[14],g=t[15],x=n*a-o*s,b=n*c-r*s,y=n*l-i*s,$=o*c-r*a,w=o*l-i*a,k=r*l-i*c,S=u*m-f*h,M=u*v-d*h,F=u*g-p*h,L=f*v-d*m,D=f*g-p*m,z=d*g-p*v,E=x*z-b*D+y*L+$*F-w*M+k*S;E&&(E=1/E,e[0]=(a*z-c*D+l*L)*E,e[1]=(r*D-o*z-i*L)*E,e[2]=(m*k-v*w+g*$)*E,e[3]=(d*w-f*k-p*$)*E,e[4]=(c*F-s*z-l*M)*E,e[5]=(n*z-r*F+i*M)*E,e[6]=(v*y-h*k-g*b)*E,e[7]=(u*k-d*y+p*b)*E,e[8]=(s*D-a*F+l*S)*E,e[9]=(o*F-n*D-i*S)*E,e[10]=(h*w-m*y+g*x)*E,e[11]=(f*y-u*w-p*x)*E,e[12]=(a*M-s*L-c*S)*E,e[13]=(n*L-o*M+r*S)*E,e[14]=(m*b-h*$-v*x)*E,e[15]=(u*$-f*b+d*x)*E)}(i,(s=i,a=o,c=r,l=a[0],u=a[1],f=a[2],d=a[3],p=a[4],h=a[5],m=a[6],v=a[7],g=a[8],x=a[9],b=a[10],y=a[11],$=a[12],w=a[13],k=a[14],S=a[15],M=c[0],F=c[1],L=c[2],D=c[3],s[0]=M*l+F*p+L*g+D*$,s[1]=M*u+F*h+L*x+D*w,s[2]=M*f+F*m+L*b+D*k,s[3]=M*d+F*v+L*y+D*S,M=c[4],F=c[5],L=c[6],D=c[7],s[4]=M*l+F*p+L*g+D*$,s[5]=M*u+F*h+L*x+D*w,s[6]=M*f+F*m+L*b+D*k,s[7]=M*d+F*v+L*y+D*S,M=c[8],F=c[9],L=c[10],D=c[11],s[8]=M*l+F*p+L*g+D*$,s[9]=M*u+F*h+L*x+D*w,s[10]=M*f+F*m+L*b+D*k,s[11]=M*d+F*v+L*y+D*S,M=c[12],F=c[13],L=c[14],D=c[15],s[12]=M*l+F*p+L*g+D*$,s[13]=M*u+F*h+L*x+D*w,s[14]=M*f+F*m+L*b+D*k,s[15]=M*d+F*v+L*y+D*S,s)),n.queue.writeBuffer(e,0,t)}}cn.WGSL="\nstruct Camera {\n  inverseMatrix : mat4x4<f32>,\n  position : vec3<f32>,\n  direction : vec3<f32>,\n  cone : f32,\n  near : f32,\n  far : f32,\n}\n";const ln=Ht(),un=nn(),fn=Ht(),dn=Ht(),pn=Ht(),hn=Xt(0,1,0);class mn{constructor({camera:e,target:t}){var n,o;this.camera=e,this.target=t,this.isFullscreen=!1,this.isLocked=!1,this.gamepad=null,this.keyboard={buttons:{run:!1},movement:Ht()},this.pointer={buttons:{primary:!1},movement:nn(),position:nn()},this.buttons={primary:!1},this.forward=Ht(),this.look={state:on(.5*Math.PI,Math.PI),target:on(.5*Math.PI,Math.PI)},this.position={state:e.position,target:(n=e.position,o=new Ot(3),o[0]=n[0],o[1]=n[1],o[2]=n[2],o)},this.speed={state:4,target:4},this.updateBounds(),t.addEventListener("contextmenu",this.onContextMenu.bind(this),!1),window.addEventListener("gamepaddisconnected",this.onGamepadDisconnected.bind(this),!1),window.addEventListener("gamepadconnected",this.onGamepadConnected.bind(this),!1),window.addEventListener("keydown",this.onKeyDown.bind(this),!1),window.addEventListener("keyup",this.onKeyUp.bind(this),!1),t.addEventListener("mousedown",this.onMouseDown.bind(this),!1),window.addEventListener("mousemove",this.onMouseMove.bind(this),!1),window.addEventListener("mouseup",this.onMouseUp.bind(this),!1),window.addEventListener("wheel",this.onMouseWheel.bind(this),{passive:!1}),document.addEventListener("fullscreenchange",this.onFullscreen.bind(this),!1),document.addEventListener("pointerlockchange",this.onPointerLock.bind(this),!1)}enterFullscreen(){const{isFullscreen:e,target:t}=this;e||t.requestFullscreen()}exitFullscreen(){const{isFullscreen:e}=this;e&&document.exitFullscreen()}lock(){const{isLocked:e,target:t}=this;e||t.requestPointerLock()}unlock(){const{isLocked:e}=this;e&&document.exitPointerLock()}onContextMenu(e){e.preventDefault()}onGamepadDisconnected({gamepad:{index:e}}){const{gamepad:t}=this;t===e&&(this.gamepad=null)}onGamepadConnected({gamepad:{index:e}}){this.gamepad=e}onKeyDown({key:e,repeat:t}){const{isLocked:n,keyboard:o}=this;if(n&&!t)switch(e.toLowerCase()){case"w":o.movement[2]=1;break;case"s":o.movement[2]=-1;break;case"a":o.movement[0]=-1;break;case"d":o.movement[0]=1;break;case"q":o.movement[1]=-1;break;case"e":o.movement[1]=1;break;case"shift":o.buttons.run=!0;break;case"r":this.reset()}}onKeyUp({key:e}){const{isLocked:t,keyboard:n}=this;if(t)switch(e.toLowerCase()){case"w":n.movement[2]>0&&(n.movement[2]=0);break;case"s":n.movement[2]<0&&(n.movement[2]=0);break;case"a":n.movement[0]<0&&(n.movement[0]=0);break;case"d":n.movement[0]>0&&(n.movement[0]=0);break;case"q":n.movement[1]<0&&(n.movement[1]=0);break;case"e":n.movement[1]>0&&(n.movement[1]=0);break;case"shift":n.buttons.run=!1}}onMouseDown({button:e}){const{isFullscreen:t,isLocked:n,pointer:o}=this;if(!n)return this.lock(),void(t||this.enterFullscreen());o.buttons.primary=0===e||2===e}onMouseMove({clientX:e,clientY:t,movementX:n,movementY:o}){const{sensitivity:r}=mn,{bounds:i,isLocked:s,pointer:{movement:a,position:c}}=this;s&&(a[0]-=n*r.pointer,a[1]+=o*r.pointer,sn(c,(e-i.x)/i.width*2-1,-(t-i.y)/i.height*2+1))}onMouseUp({button:e}){const{isLocked:t,pointer:n}=this;!t||0!==e&&2!==e||(n.buttons.primary=!1)}onMouseWheel(e){const{sensitivity:t,minSpeed:n,speedRange:o}=mn,{isLocked:r,speed:i}=this;if(e.ctrlKey&&e.preventDefault(),!r)return;const s=Math.min(Math.max((Math.log(i.target)-n)/o-e.deltaY*t.wheel,0),1);i.target=Math.exp(n+s*o)}onFullscreen(){this.isFullscreen=!!document.fullscreenElement}onPointerLock(){const{buttons:e,keyboard:t,pointer:n}=this;this.isLocked=!!document.pointerLockElement,this.isLocked||(e.primary=!1,Jt(t.movement,0,0,0),t.buttons.run=!1,n.buttons.primary=!1)}update(e){const{minPhi:t,maxPhi:n,sensitivity:o}=mn,{isLocked:r,buttons:i,camera:s,forward:a,gamepad:c,keyboard:l,pointer:u,look:f,position:d,speed:p}=this;let h=!1;if(r){if(h=l.buttons.run,i.primary=u.buttons.primary,Kt(fn,l.movement),rn(un,u.movement),null!==c){const{axes:e,buttons:t}=navigator.getGamepads()[c];(t[6]&&t[6].pressed||t[7]&&t[7].pressed)&&(i.primary=!0),Math.max(Math.abs(e[2]),Math.abs(e[3]))>.1&&sn(un,-e[2]*o.gamepad,-e[3]*o.gamepad),Math.max(Math.abs(e[0]),Math.abs(e[1]))>.1&&Jt(fn,e[0],0,-e[1]),t[4]&&t[4].pressed?fn[1]=-1:t[5]&&t[5].pressed&&(fn[1]=1),t[10]&&t[10].pressed&&(h=!0)}f.target[0]=Math.min(Math.max(f.target[0]+un[1],t),n),f.target[1]+=un[0]}sn(u.movement,0,0);{const t=1-Math.exp(-20*e);m=f.state,v=f.state,g=f.target,x=t,b=v[0],y=v[1],m[0]=b+x*(g[0]-b),m[1]=y+x*(g[1]-y),p.state=p.state*(1-t)+p.target*t}var m,v,g,x,b,y;if(Jt(a,Math.sin(f.state[0])*Math.sin(f.state[1]),Math.cos(f.state[0]),Math.sin(f.state[0])*Math.cos(f.state[1])),0!==fn[0]||0!==fn[1]||0!==fn[2]){Kt(dn,a),Qt(pn,function(e,t,n){var o=t[0],r=t[1],i=t[2],s=n[0],a=n[1],c=n[2];return e[0]=r*c-i*a,e[1]=i*s-o*c,e[2]=o*a-r*s,e}(pn,dn,hn)),en(ln),Zt(ln,ln,pn,fn[0]),Zt(ln,ln,hn,fn[1]),Zt(ln,ln,dn,fn[2]),en(fn);const t=function(e){var t=e[0],n=e[1],o=e[2];return Math.hypot(t,n,o)}(ln);t>1&&function(e,t,n){e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n}(ln,ln,1/t),Zt(d.target,d.target,ln,e*p.state*(h?2:1))}{const t=1-Math.exp(-10*e);!function(e,t,n,o){var r=t[0],i=t[1],s=t[2];e[0]=r+o*(n[0]-r),e[1]=i+o*(n[1]-i),e[2]=s+o*(n[2]-s)}(d.state,d.state,d.target,t),function(e,t,n){e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2]}(s.target,s.position,a),s.updateView()}}updateBounds(){const{target:e}=this,t=e.getBoundingClientRect();this.bounds={width:Math.max(t.width,1),height:Math.max(t.height,1),x:t.x,y:t.y}}reset(){const{look:e,position:t}=this;en(t.target),Kt(t.state,t.target),sn(e.target,.5*Math.PI,Math.PI),rn(e.state,e.target)}}mn.sensitivity={gamepad:.03,pointer:.003,wheel:3e-4},mn.minPhi=.01,mn.maxPhi=Math.PI-.01,mn.minSpeed=Math.log(2),mn.maxSpeed=Math.log(64),mn.speedRange=mn.maxSpeed-mn.minSpeed;var vn="struct FragmentOutput {\n  @location(0) color : vec4<f32>,\n  @location(1) data : vec4<f32>,\n  @location(2) position : vec4<f32>,\n}\n\nstruct VertexOutput {\n  @builtin(position) position : vec4<f32>,\n  @location(0) ray : vec3<f32>,\n}\n\n@group(0) @binding(0) var<uniform> camera : Camera;\n@group(0) @binding(1) var<uniform> time : f32;\n\nconst epsilon : f32 = 0.01;\n\nfn getNormal(pos : vec3<f32>, distance : f32) -> vec3<f32> {\n  const o : vec2<f32> = vec2<f32>(epsilon, 0);\n  return normalize(\n    distance - vec3<f32>(\n      getScene(pos - o.xyy).distance,\n      getScene(pos - o.yxy).distance,\n      getScene(pos - o.yyx).distance\n    )\n  );\n}\n\n@vertex\nfn vertex(@builtin(vertex_index) index : u32) -> VertexOutput {\n  // Hack to prevent BindGroup errors\n  // when user code doesn't use all of the uniforms\n  let t : f32 = time;\n\n  const quad = array<vec2<f32>, 6>(\n    vec2<f32>(-1, -1), vec2<f32>(1, -1), vec2<f32>(-1, 1),\n    vec2<f32>(-1, 1), vec2<f32>(1, -1), vec2<f32>(1, 1)\n  );\n  var out : VertexOutput;\n  out.position = vec4<f32>(quad[index], 0, 1);\n  let r : vec4<f32> = camera.inverseMatrix * vec4<f32>(quad[index], 0.5, 1);\n  out.ray = normalize((r.xyz / r.w) - camera.position);\n  return out;\n}\n\n@fragment\nfn conetracing(@location(0) ray : vec3<f32>) -> FragmentOutput {\n  var out : FragmentOutput;\n  var coverage : f32 = 1;\n  var depth : f32 = camera.near;\n  for (var i : u32 = 0; i < maxIterations && depth < camera.far; i++) {\n    let pos : vec3<f32> = camera.position + ray * depth;\n    let step : SDF = getScene(pos);\n    let cone : f32 = camera.cone * depth;\n    if (step.distance < cone) {\n      let alpha : f32 = smoothstep(cone, -cone, step.distance);\n      let normal : vec3<f32> = getNormal(pos, step.distance);\n      out.color += vec4<f32>(step.color * alpha * coverage, 0);\n      out.data += vec4<f32>(normal, depth) * alpha * coverage;\n      out.position += vec4<f32>(pos * alpha * coverage, 0);\n      coverage *= 1 - alpha;\n      if (coverage <= epsilon * 0.1) {\n        break;\n      }\n    }\n    depth += max(step.distance, epsilon);\n  }\n  if (coverage < 1) {\n    out.color = vec4<f32>(out.color.xyz, 1 - coverage);\n    out.data = vec4<f32>(normalize(out.data.xyz), out.data.w);\n    return out;\n  }\n  discard;\n}\n\n@fragment\nfn raymarching(@location(0) ray : vec3<f32>) -> FragmentOutput {\n  var out : FragmentOutput;\n  var depth : f32 = camera.near;\n  for (var i : u32 = 0; i < maxIterations && depth < camera.far; i++) {\n    let pos : vec3<f32> = camera.position + ray * depth;\n    let step : SDF = getScene(pos);\n    if (step.distance < epsilon) {\n      let normal : vec3<f32> = getNormal(pos, step.distance);\n      out.color = vec4<f32>(step.color, 1);\n      out.data = vec4<f32>(normal, depth);\n      out.position = vec4<f32>(pos, 1);\n      return out;\n    }\n    depth += max(step.distance, epsilon);\n  }\n  discard;\n}\n",gn="fn hsl2Rgb(hsl : vec3<f32>) -> vec3<f32> {\n  let h : f32 = clamp(hsl.x, 0, 1);\n  let s : f32 = clamp(hsl.y, 0, 1);\n  let l : f32 = clamp(hsl.z, 0, 1);\n  if (s == 0) {\n    return vec3<f32>(l, l, l);\n  }\n  var q : f32;\n  if (l < 0.5) {\n    q = l * (1 + s);\n  } else {\n    q = l + s - l * s;\n  }\n  let p = 2 * l - q;\n  return vec3<f32>(\n    hue2Rgb(p, q, h + 1 / 3.0),\n    hue2Rgb(p, q, h),\n    hue2Rgb(p, q, h - 1 / 3.0)\n  );\n}\n\nfn hue2Rgb(p : f32, q : f32, tt : f32) -> f32 {\n  var t : f32 = tt;\n  if (t < 0) { t += 1; }\n  if (t > 1) { t -= 1; }\n  if (t < 1 / 6.0) { return p + (q - p) * 6 * t; }\n  if (t < 1 / 2.0) { return q; }\n  if (t < 2 / 3.0) { return p + (q - p) * (2 / 3.0 - t) * 6; }\n  return p;\n}\n",xn="fn permute4(x : vec4<f32>) -> vec4<f32> { return ((x * 34. + 1.) * x) % vec4<f32>(289.); }\nfn taylorInvSqrt4(r : vec4<f32>) -> vec4<f32> { return 1.79284291400159 - 0.85373472095314 * r; }\n\nfn SimplexNoise(v : vec3<f32>) -> f32 {\n  let C = vec2<f32>(1. / 6., 1. / 3.);\n  let D = vec4<f32>(0., 0.5, 1., 2.);\n\n  var i: vec3<f32>  = floor(v + dot(v, C.yyy));\n  let x0 = v - i + dot(i, C.xxx);\n\n  let g = step(x0.yzx, x0.xyz);\n  let l = 1.0 - g;\n  let i1 = min(g.xyz, l.zxy);\n  let i2 = max(g.xyz, l.zxy);\n\n  let x1 = x0 - i1 + 1. * C.xxx;\n  let x2 = x0 - i2 + 2. * C.xxx;\n  let x3 = x0 - 1. + 3. * C.xxx;\n\n  i = i % vec3<f32>(289.);\n  let p = permute4(permute4(permute4(\n      i.z + vec4<f32>(0., i1.z, i2.z, 1. )) +\n      i.y + vec4<f32>(0., i1.y, i2.y, 1. )) +\n      i.x + vec4<f32>(0., i1.x, i2.x, 1. ));\n\n  var n_: f32 = 1. / 7.;\n  let ns = n_ * D.wyz - D.xzx;\n\n  let j = p - 49. * floor(p * ns.z * ns.z);\n\n  let x_ = floor(j * ns.z);\n  let y_ = floor(j - 7.0 * x_);\n\n  let x = x_ *ns.x + ns.yyyy;\n  let y = y_ *ns.x + ns.yyyy;\n  let h = 1.0 - abs(x) - abs(y);\n\n  let b0 = vec4<f32>( x.xy, y.xy );\n  let b1 = vec4<f32>( x.zw, y.zw );\n\n  let s0 = floor(b0)*2.0 + 1.0;\n  let s1 = floor(b1)*2.0 + 1.0;\n  let sh = -step(h, vec4<f32>(0.));\n\n  let a0 = b0.xzyw + s0.xzyw*sh.xxyy ;\n  let a1 = b1.xzyw + s1.xzyw*sh.zzww ;\n\n  var p0: vec3<f32> = vec3<f32>(a0.xy, h.x);\n  var p1: vec3<f32> = vec3<f32>(a0.zw, h.y);\n  var p2: vec3<f32> = vec3<f32>(a1.xy, h.z);\n  var p3: vec3<f32> = vec3<f32>(a1.zw, h.w);\n\n  let norm = taylorInvSqrt4(vec4<f32>(dot(p0,p0), dot(p1,p1), dot(p2,p2), dot(p3,p3)));\n  p0 = p0 * norm.x;\n  p1 = p1 * norm.y;\n  p2 = p2 * norm.z;\n  p3 = p3 * norm.w;\n\n  var m: vec4<f32> = 0.6 - vec4<f32>(dot(x0,x0), dot(x1,x1), dot(x2,x2), dot(x3,x3));\n  m = max(m, vec4<f32>(0.));\n  m = m * m;\n  return 42. * dot(m * m, vec4<f32>(dot(p0,x0), dot(p1,x1), dot(p2,x2), dot(p3,x3)));\n}\n",bn="const PI : f32 = 3.141592653589793;\n\nfn rotateX(radians : f32) -> mat3x3<f32> {\n  var c : f32 = cos(radians);\n  var s : f32 = sin(radians);\n  return mat3x3<f32>(\n    1, 0, 0,\n    0, c, s,\n    0, -s, c,\n  );\n}\n\nfn rotateY(radians : f32) -> mat3x3<f32> {\n  var c : f32 = cos(radians);\n  var s : f32 = sin(radians);\n  return mat3x3<f32>(\n    c, 0, -s,\n    0, 1, 0,\n    s, 0, c,\n  );\n}\n\nfn rotateZ(radians : f32) -> mat3x3<f32> {\n  var c : f32 = cos(radians);\n  var s : f32 = sin(radians);\n  return mat3x3<f32>(\n    c, s, 0,\n    -s, c, 0,\n    0, 0, 1,\n  );\n}\n\nfn spherical(phi : f32, theta : f32, radius : f32) -> vec3<f32> {\n  let sinPhiRadius = sin(phi) * radius;\n  return vec3<f32>(\n    sinPhiRadius * sin(theta),\n    cos(phi) * radius,\n    sinPhiRadius * cos(theta)\n  );\n}\n",yn="struct SDF {\n  color : vec3<f32>,\n  distance : f32,\n}\n\nfn opUnion(a : SDF, b : SDF) -> SDF {\n  if (a.distance < b.distance) {\n    return a;\n  }\n  return b;\n}\n\nfn opSubstraction(a : SDF, b : SDF) -> SDF {\n  if (a.distance > -b.distance) {\n    return a;\n  }\n  return SDF(b.color, -b.distance);\n}\n\nfn opSmoothUnion(a : SDF, b : SDF, k : f32) -> SDF {\n  let h : f32 = clamp(0.5 + 0.5 * (b.distance - a.distance) / k, 0, 1);\n  return SDF(\n    mix(b.color, a.color, h),\n    mix(b.distance, a.distance, h) - k*h*(1-h)\n  );\n}\n\nfn opSmoothSubstraction(a : SDF, b : SDF, k : f32) -> SDF {\n  let h : f32 = clamp(0.5 - 0.5 * (a.distance + b.distance) / k, 0, 1);\n  return SDF(\n    mix(a.color, b.color, h),\n    mix(a.distance, -b.distance, h) + k*h*(1-h)\n  );\n}\n\nfn sdBox(p : vec3<f32>, r : vec3<f32>) -> f32 {\n  let q : vec3<f32> = abs(p) - r;\n  return length(max(q, vec3<f32>(0))) + min(max(q.x, max(q.y, q.z)), 0);\n}\n\nfn sdCapsule(p : vec3<f32>, r : vec2<f32>) -> f32 {\n  let q : vec3<f32> = vec3<f32>(p.x, p.y - clamp(p.y, -r.y + r.x, r.y - r.x), p.z);\n  return length(q) - r.x;\n}\n\nfn sdEllipsoid(p : vec3<f32>, r : vec3<f32>) -> f32 {\n  let k0 : f32 = length(p / r);\n  let k1 : f32 = length(p / (r * r));\n  return k0 * (k0 - 1.0) / k1;\n}\n\nfn sdPlane(p : vec3<f32>, n : vec3<f32>, h : f32) -> f32 {\n  return dot(p,n) + h;\n}\n\nfn sdSphere(p : vec3<f32>, r : f32) -> f32 {\n  return length(p) - r;\n}\n\nfn sdTorus(p : vec3<f32>, r : vec2<f32>) -> f32 {\n  let q : vec2<f32> = vec2<f32>(length(p.xz) - r.x, p.y);\n  return length(q) - r.y;\n}\n";class $n{constructor(e){this.renderer=e}render(e){const{bindings:t,pipeline:n}=this;e.setPipeline(n),e.setBindGroup(0,t),e.draw(6)}setMaxIterations(e){this.maxIterations=e,this.updatePipeline()}setMode(e){this.mode=e,this.updatePipeline()}setScene(e){this.scene=e,this.updatePipeline()}updatePipeline(){const{renderer:{camera:e,device:t,time:n},maxIterations:o,mode:r,scene:i}=this;o&&r&&i&&(this.code=[`const maxIterations : u32 = ${o};`,e.constructor.WGSL,vn,gn,xn,bn,yn,"// __SOURCE__",i].join("\n"),this.module=t.createShaderModule({code:this.code}),this.pipeline=t.createRenderPipeline({layout:"auto",vertex:{entryPoint:"vertex",module:this.module},fragment:{entryPoint:r,module:this.module,targets:[{format:"rgba32float"},{format:"rgba32float"},{format:"rgba32float"}]},primitive:{topology:"triangle-list"}}),this.bindings=t.createBindGroup({layout:this.pipeline.getBindGroupLayout(0),entries:[{binding:0,resource:{buffer:e.buffer}},{binding:1,resource:{buffer:n}}]}))}}var wn="@group(0) @binding(0) var<uniform> camera : Camera;\n@group(0) @binding(1) var<uniform> time : f32;\n@group(1) @binding(0) var colorTexture : texture_2d<f32>;\n@group(1) @binding(1) var dataTexture : texture_2d<f32>;\n@group(1) @binding(2) var positionTexture : texture_2d<f32>;\n\nfn linearTosRGB(linear : vec3<f32>) -> vec3<f32> {\n  if (all(linear <= vec3<f32>(0.0031308))) {\n    return linear * 12.92;\n  }\n  return (pow(abs(linear), vec3<f32>(1.0/2.4)) * 1.055) - vec3<f32>(0.055);\n}\n\n@vertex\nfn vertex(@builtin(vertex_index) index : u32) -> @builtin(position) vec4<f32> {\n  // Hack to prevent BindGroup errors\n  // when user code doesn't use all of the uniforms\n  let t : f32 = time;\n\n  const quad = array<vec2<f32>, 6>(\n    vec2<f32>(-1, -1), vec2<f32>(1, -1), vec2<f32>(-1, 1),\n    vec2<f32>(-1, 1), vec2<f32>(1, -1), vec2<f32>(1, 1)\n  );\n  return vec4<f32>(quad[index], 0, 1);\n}\n\n@fragment\nfn fragment(@builtin(position) uv : vec4<f32>) -> @location(0) vec4<f32> {\n  return vec4<f32>(linearTosRGB(getEffect(vec2<i32>(floor(uv.xy)))), 1);\n}\n",kn="struct Light {\n  position : vec3<f32>,\n  diffuse : vec3<f32>,\n  specular : vec3<f32>,\n}\n\nfn getAttenuation(dist : f32, constant : f32, linear : f32, quadratic : f32) -> f32 {\n  return 1.0 / (constant + linear * dist + quadratic * (dist * dist));\n}\n\nfn getDirectLight(light : Light, normal : vec3<f32>, position : vec3<f32>, shininess : f32) -> vec3<f32> {\n  let lightDir = normalize(light.position - position);\n  let viewDir : vec3<f32> = normalize(camera.position - position);\n  let halfwayDir : vec3<f32> = normalize(lightDir + viewDir);\n\n  let diffuse : vec3<f32> = max(dot(lightDir, normal), 0) * light.diffuse;\n  let specular : vec3<f32> = pow(max(dot(normal, halfwayDir), 0), shininess) * light.specular;\n\n  return diffuse + specular;\n}\n";class Sn{constructor({device:e,camera:t,format:n,time:o}){this.device=e,this.camera=t,this.format=n,this.time=o,this.descriptor={colorAttachments:[{clearValue:{r:0,g:0,b:0,a:1},loadOp:"clear",storeOp:"store"}]}}render(e,t){const{bindings:n,descriptor:o,pipeline:r,uniforms:i}=this;o.colorAttachments[0].view=t;const s=e.beginRenderPass(o);s.setPipeline(r),s.setBindGroup(0,i),s.setBindGroup(1,n),s.draw(6),s.end()}bindTextures(){const{device:e,pipeline:t,textures:n}=this;t&&n&&(this.bindings=e.createBindGroup({layout:t.getBindGroupLayout(1),entries:[{binding:0,resource:n.color},{binding:1,resource:n.data},{binding:2,resource:n.position}]}))}setEffect(e){const{device:t,camera:n,format:o,time:r}=this;this.code=[n.constructor.WGSL,wn,kn,bn,"// __SOURCE__",e].join("\n"),this.module=t.createShaderModule({code:this.code}),this.pipeline=t.createRenderPipeline({layout:"auto",vertex:{entryPoint:"vertex",module:this.module},fragment:{entryPoint:"fragment",module:this.module,targets:[{format:o}]},primitive:{topology:"triangle-list"}}),this.uniforms=t.createBindGroup({layout:this.pipeline.getBindGroupLayout(0),entries:[{binding:0,resource:{buffer:n.buffer}},{binding:1,resource:{buffer:r}}]}),this.bindTextures()}setTextures({color:e,data:t,position:n}){this.textures={color:e,data:t,position:n},this.bindTextures()}}class Mn{constructor({adapter:e,camera:t,device:n}){const o=navigator.gpu.getPreferredCanvasFormat(e);this.camera=t,this.device=n,this.canvas=document.createElement("canvas"),this.canvas.style.imageRendering="pixelated",this.context=this.canvas.getContext("webgpu"),this.descriptor={colorAttachments:[{clearValue:{r:0,g:0,b:0,a:1},loadOp:"clear",storeOp:"store"},{clearValue:{r:0,g:0,b:0,a:t.far},loadOp:"clear",storeOp:"store"},{clearValue:{r:0,g:0,b:0,a:0},loadOp:"clear",storeOp:"store"}]},this.time=n.createBuffer({size:Float32Array.BYTES_PER_ELEMENT,usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.UNIFORM}),this.postprocessing=new Sn({device:n,camera:t,format:o,time:this.time}),this.resolution=1,this.scene=[],this.textures=new Map,this.setSize(window.innerWidth,window.innerHeight),this.context.configure({alphaMode:"opaque",device:n,format:o})}render(e){const{context:t,descriptor:n,postprocessing:o,scene:r}=this,i=e.beginRenderPass(n);r.forEach((e=>e.render(i))),i.end(),o.render(e,t.getCurrentTexture().createView())}setSize(e,t,n=window.devicePixelRatio||1){const{camera:o,canvas:r,descriptor:i,postprocessing:s,resolution:a}=this,c=[Math.max(Math.floor(e*n*a),1),Math.max(Math.floor(t*n*a),1)];r.width=c[0],r.height=c[1],r.style.width=`${e}px`,r.style.height=`${t}px`,o.setSize(c[0],c[1]),this.updateTexture(i.colorAttachments[0],"rgba32float","color",c),this.updateTexture(i.colorAttachments[1],"rgba32float","data",c),this.updateTexture(i.colorAttachments[2],"rgba32float","position",c),s.setTextures({color:i.colorAttachments[0].view,data:i.colorAttachments[1].view,position:i.colorAttachments[2].view})}updateTexture(e,t,n,o){const{device:r,textures:i}=this,s=i.get(n);s&&s.destroy();const a=r.createTexture({format:t,size:o,usage:GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.TEXTURE_BINDING});e.view=a.createView(),i.set(n,a)}}function Fn(t){let n;return{c(){n=b("div"),S(n,"class","viewport svelte-vo8in0")},m(e,o){v(e,n,o),t[1](n)},p:e,i:e,o:e,d(e){e&&g(n),t[1](null)}}}function Ln(e,t,n){let o;return _((()=>{const{adapter:e,device:t}=he.gpu,n=new cn({device:t}),r=new mn({camera:n,target:o}),i=new Mn({adapter:e,camera:n,device:t});window.addEventListener("resize",(()=>{r.updateBounds(),i.setSize(r.bounds.width,r.bounds.height)}),!1),o.appendChild(i.canvas);const s=new $n(i);i.scene.push(s);const a=new Float32Array([performance.now()/1e3]);document.addEventListener("visibilitychange",(()=>{"visible"===document.visibilityState&&(a[0]=performance.now()/1e3)}),!1);let c=!1;const l=()=>{requestAnimationFrame(l);const e=performance.now()/1e3,n=Math.min(e-a[0],1);if(a[0]=e,c)return;r.update(n),t.queue.writeBuffer(i.time,0,a);const o=t.createCommandEncoder();i.render(o),t.queue.submit([o.finish()])},u=({code:e,module:t},n)=>{c=!1;const o=e.split("\n"),r=o.indexOf("// __SOURCE__")+1;t.compilationInfo().then((({messages:e})=>n.set(e.map((({length:e,lineNum:t,linePos:n,message:i,type:s})=>(c=!0,{line:o[t-1],lineNum:t-r,linePos:n,length:e,message:i,pointer:Array.from({length:n-1+e},((e,t)=>t>=n-1?"^":" ")).join(""),type:s}))))))};he.input=r,he.iterations.subscribe((e=>s.setMaxIterations(e))),he.mode.subscribe((e=>s.setMode(e))),he.resolution.subscribe((e=>{i.resolution=Math.pow(.5,Math.floor(6*(1-e))),i.setSize(r.bounds.width,r.bounds.height)})),fe.source.subscribe((e=>{i.postprocessing.setEffect(e),u(i.postprocessing,fe.errors)})),pe.source.subscribe((e=>{s.setScene(e),u(s,pe.errors)})),requestAnimationFrame(l)})),[o,function(e){C[e?"unshift":"push"]((()=>{o=e,n(0,o)}))}]}class Dn extends oe{constructor(e){super(),ne(this,e,Ln,Fn,i,{})}}const{window:zn}=Z;function En(e){let t,n;return t=new mt({}),{c(){Q(t.$$.fragment)},m(e,o){ee(t,e,o),n=!0},i(e){n||(K(t.$$.fragment,e),n=!0)},o(e){J(t.$$.fragment,e),n=!1},d(e){te(t,e)}}}function Pn(e){let t,n;return t=new Xe({}),{c(){Q(t.$$.fragment)},m(e,o){ee(t,e,o),n=!0},i(e){n||(K(t.$$.fragment,e),n=!0)},o(e){J(t.$$.fragment,e),n=!1},d(e){te(t,e)}}}function _n(e){let t,n;return t=new Me({}),{c(){Q(t.$$.fragment)},m(e,o){ee(t,e,o),n=!0},i(e){n||(K(t.$$.fragment,e),n=!0)},o(e){J(t.$$.fragment,e),n=!1},d(e){te(t,e)}}}function qn(e){let t,n,i,s,a,c,l,u,f,d,p,h,x,y,w,M,L;i=new Nt({});const D=[_n,Pn,En],z=[];function E(e,t){return"effect"===e[1]?0:"scene"===e[1]?1:"settings"===e[1]?2:-1}return~(a=E(e))&&(c=z[a]=D[a](e)),d=new Dn({}),h=new ze({}),y=new Ye({}),{c(){t=b("div"),n=b("div"),Q(i.$$.fragment),s=$(),c&&c.c(),l=$(),u=b("div"),f=$(),Q(d.$$.fragment),p=$(),Q(h.$$.fragment),x=$(),Q(y.$$.fragment),S(n,"class","ui svelte-efpout"),F(n,"width",e[0].state+"px"),S(u,"class","divider svelte-efpout"),S(t,"class","app svelte-efpout")},m(o,c){v(o,t,c),m(t,n),ee(i,n,null),m(n,s),~a&&z[a].m(n,null),m(t,l),m(t,u),m(t,f),ee(d,t,null),v(o,p,c),ee(h,o,c),v(o,x,c),ee(y,o,c),w=!0,M||(L=[k(zn,"mousemove",(function(){r(e[0].enabled&&e[3])&&(e[0].enabled&&e[3]).apply(this,arguments)})),k(zn,"mouseup",(function(){r(e[0].enabled&&e[4])&&(e[0].enabled&&e[4]).apply(this,arguments)})),k(u,"mousedown",e[2])],M=!0)},p(t,[o]){let r=a;a=E(e=t),a!==r&&(c&&(H(),J(z[r],1,1,(()=>{z[r]=null})),X()),~a?(c=z[a],c||(c=z[a]=D[a](e),c.c()),K(c,1),c.m(n,null)):c=null),(!w||1&o)&&F(n,"width",e[0].state+"px")},i(e){w||(K(i.$$.fragment,e),K(c),K(d.$$.fragment,e),K(h.$$.fragment,e),K(y.$$.fragment,e),w=!0)},o(e){J(i.$$.fragment,e),J(c),J(d.$$.fragment,e),J(h.$$.fragment,e),J(y.$$.fragment,e),w=!1},d(e){e&&g(t),te(i),~a&&z[a].d(),te(d),e&&g(p),te(h,e),e&&g(x),te(y,e),M=!1,o(L)}}}function Cn(e,t,n){let o;c(e,le,(e=>n(1,o=e)));const r={enabled:!1,initial:0,offset:0,state:512};return[r,o,({clientX:e})=>{n(0,r.enabled=!0,r),n(0,r.initial=r.state,r),n(0,r.offset=e,r)},({clientX:e})=>{n(0,r.state=Math.max(Math.floor(r.initial+e-r.offset),340),r),I().then((()=>window.dispatchEvent(new Event("resize"))))},()=>{n(0,r.enabled=!1,r)}]}class Tn extends oe{constructor(e){super(),ne(this,e,Cn,qn,i,{})}}function jn(e){let t,n;return t=new Tn({}),{c(){Q(t.$$.fragment)},m(e,o){ee(t,e,o),n=!0},i(e){n||(K(t.$$.fragment,e),n=!0)},o(e){J(t.$$.fragment,e),n=!1},d(e){te(t,e)}}}function Rn(t){let n;return{c(){n=b("div"),n.innerHTML='Sorry! You&#39;ll need to try this in a browser with WebGPU support like <a href="https://www.google.com/chrome" rel="noopener noreferrer" target="_blank" class="svelte-1bwkh19">Chrome</a>.',S(n,"class","support svelte-1bwkh19")},m(e,t){v(e,n,t)},i:e,o:e,d(e){e&&g(n)}}}function Bn(t){let n;return{c(){n=b("div"),n.textContent="Loading...",S(n,"class","loading svelte-1bwkh19")},m(e,t){v(e,n,t)},i:e,o:e,d(e){e&&g(n)}}}function Un(e){let t,n,o,r,i,s,a;const c=[Bn,Rn,jn],l=[];function u(e,t){return e[1]?0:e[0]?1:2}return t=u(e),n=l[t]=c[t](e),{c(){n.c(),o=$(),r=b("div"),r.innerHTML='marcher - <a href="https://github.com/danielesteban/marcher" rel="noopener noreferrer" target="_blank" class="svelte-1bwkh19">view source</a><br/> \n  <a href="https://dani.gatunes.com" rel="noopener noreferrer" target="_blank" class="svelte-1bwkh19">dani@gatunes</a> © 2022',i=$(),s=b("a"),s.textContent="♥ Become a sponsor",S(r,"class","info svelte-1bwkh19"),S(s,"class","ribbon svelte-1bwkh19"),S(s,"href","https://github.com/sponsors/danielesteban"),S(s,"data-ribbon","♥ Become a sponsor"),S(s,"rel","noopener noreferrer"),S(s,"target","_blank")},m(e,n){l[t].m(e,n),v(e,o,n),v(e,r,n),v(e,i,n),v(e,s,n),a=!0},p(e,[r]){let i=t;t=u(e),t!==i&&(H(),J(l[i],1,1,(()=>{l[i]=null})),X(),n=l[t],n||(n=l[t]=c[t](e),n.c()),K(n,1),n.m(o.parentNode,o))},i(e){a||(K(n),a=!0)},o(e){J(n),a=!1},d(e){l[t].d(e),e&&g(o),e&&g(r),e&&g(i),e&&g(s)}}}function In(e,t,n){let o=!1,r=!0;return Promise.all([(async()=>{if(!navigator.gpu)throw new Error("WebGPU support");const e=await navigator.gpu.requestAdapter();if(!e)throw new Error("WebGPU adapter");const t=await e.requestDevice();return{adapter:e,device:t}})(),new Promise(((e,t)=>{const n={paths:{vs:"https://cdn.jsdelivr.net/npm/monaco-editor@0.34.0/min/vs"}},o=document.createElement("script");o.onload=()=>{require.config(n),require(["vs/editor/editor.main"],e)},o.onerror=t,o.src=`${n.paths.vs}/loader.js`,document.head.appendChild(o)}))]).then((([e])=>{he.gpu=e})).catch((e=>{console.error(e),n(0,o=!0)})).finally((()=>{n(1,r=!1)})),[o,r]}new class extends oe{constructor(e){super(),ne(this,e,In,Un,i,{})}}({target:document.body})}();
